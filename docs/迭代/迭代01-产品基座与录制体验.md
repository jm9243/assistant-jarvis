# 助手-贾维斯 PRD · 迭代01：产品基座与录制体验

> 覆盖原始 PRD 的第1-4.3章，聚焦愿景、用户画像、系统架构以及账号、安全、Studio 与智能录制器能力。

**版本**: V2.2  
**日期**: 2025-11-08  
**文档状态**: 正式版  
**适用范围**: PC端、移动端、管理后台

---

## 目录

1. [产品概述](#1-产品概述)
2. [目标用户](#2-目标用户)
3. [产品架构](#3-产品架构)
4. [PC端功能需求](#4-pc端功能需求)
5. [移动端功能需求](#5-移动端功能需求)
6. [管理后台功能需求](#6-管理后台功能需求)
7. [技术架构概览](#7-技术架构概览)
8. [非功能性需求](#8-非功能性需求)
9. [产品路线图](#9-产品路线图)
10. [成功指标](#10-成功指标)

---

## 1. 产品概述

### 1.1 产品愿景

"助手-贾维斯"是一款旨在重新定义个人生产力的跨平台智能助理。它以强大的机器人流程自动化（RPA）为执行基础，以先进的多智能体（Multi-Agent）系统为决策核心，致力于将用户从重复、繁琐的数字化工作中解放出来，并能主动、智能地处理实时通信任务（包括语音通话和视频通话），最终成为用户在数字世界中不可或缺的AI伙伴。

**核心设计哲学：驾驶舱与引擎分离**

本产品采用"驾驶舱与引擎分离"的架构设计：
- **驾驶舱（Frontend UI）**：使用现代Web技术（Tauri 2 + React）构建的轻量、高性能图形界面，负责用户交互、工作流可视化编排和任务状态呈现，但不执行任何底层自动化逻辑
- **引擎（Backend Core）**：独立的Python Sidecar后台进程，集成AI决策、GUI/Web自动化、系统级集成等所有核心能力，是所有任务的实际执行者

这种架构确保了前端的流畅性和跨平台一致性，同时将后端复杂的、平台相关的逻辑完全解耦，极大提升了系统的稳定性、安全性和未来的可扩展性。

### 1.2 核心价值

- **极致自动化**: 通过智能录制器和可视化工作流设计器，让任何人都能轻松创建复杂的自动化流程
- **AI驱动**: 基于先进的Multi-Agent系统，支持自然语言交互，智能理解和执行任务
- **跨平台协同**: PC端执行、移动端监控、云端管理，无缝协同工作
- **开放生态**: 支持模板市场、工具商店，构建开放的自动化生态系统

### 1.3 产品定位

- **C端用户**: 个人效率工具，帮助用户自动化日常重复工作
- **B端客户**: 企业级自动化平台，提供工作流协同、团队管理、数据安全等能力
- **开发者**: 开放的Agent和工作流平台，支持自定义扩展和二次开发

---

## 2. 目标用户

### 2.1 用户画像

**高效能办公族（张伟）**
- **年龄**: 30岁
- **职业**: 市场经理
- **痛点**: 每天处理大量报表、整理客户资料、发送周报邮件，重复工作占据大量时间
- **需求**: 将固定流程自动化，节省时间用于更有创造性的策略思考
- **关注功能**: 工作流录制、数据提取、报表自动生成、邮件自动发送

**技术爱好者（李静）**
- **年龄**: 25岁
- **职业**: 程序员
- **痛点**: 需要频繁在多个系统之间切换操作，希望有更强大的自动化能力
- **需求**: 足够强大、开放的自动化平台，可以定制复杂的个性化工作流
- **关注功能**: 高级工作流编排、API集成、自定义脚本、Agent开发

**小微企业主（王老板）**
- **年龄**: 40岁
- **职业**: 电商创业者
- **痛点**: 人手有限，需要亲自处理订单、回复客户咨询，无法休息
- **需求**: 7×24小时的"数字员工"，能在休息时处理客服和订单任务
- **关注功能**: AI通话接听、智能客服、订单处理自动化、移动端监控

**企业IT管理员（刘工）**
- **年龄**: 35岁
- **职业**: IT部门负责人
- **痛点**: 需要为公司部署统一的自动化解决方案，管理员工的使用权限和数据安全
- **需求**: 企业级管理后台，支持用户管理、权限控制、数据审计
- **关注功能**: 用户管理、权限系统、审计日志、模板统一管理

---

## 3. 产品架构

### 3.1 三端架构

```
┌─────────────────────────────────────────────────────────────────┐
│                          云端服务层                              │
│                       (Go + Supabase)                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  用户管理    │  │  模板市场    │  │  数据存储    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  支付系统    │  │  模型服务    │  │  监控统计    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
            ↕ WebSocket/HTTPS              ↕ WebSocket/HTTPS
            (实时状态同步)                   (远程控制指令)
┌──────────────────────────────┐  ┌──────────────────────────────┐
│        PC客户端               │  │    移动端 (iOS/Android)       │
│     (Tauri 2 + React)         │  │      (React Native)          │
│  ┌────────────────────────┐  │  │  ┌────────────────────────┐  │
│  │   工作流设计器         │  │  │  │     实时监控           │  │
│  │   Agent中心            │  │  │  │     远程控制           │  │
│  │   自动化执行           │  │  │  │     通知中心           │  │
│  │   智能录制             │  │  │  │     任务管理           │  │
│  │   AI通话               │  │  │  │     通话记录           │  │
│  │   知识库               │  │  │  │     统计报表           │  │
│  └────────────────────────┘  │  │  └────────────────────────┘  │
└──────────────────────────────┘  └──────────────────────────────┘

说明：
- PC端和移动端都通过云端进行通信，不直接连接
- PC端通过WebSocket实时上报任务状态、执行日志到云端
- 移动端通过WebSocket订阅云端状态更新，实现实时监控
- 移动端发送远程控制指令到云端，云端转发给对应的PC端
- 支持跨网络环境（PC和手机不在同一局域网）的远程管理
```

### 3.2 数据流向

**PC端 ↔ 云端**：
- **上行**：工作流定义、执行日志、任务状态、通话记录、使用统计
- **下行**：模板下载、模型服务调用、远程控制指令（来自移动端）、配置同步

**移动端 ↔ 云端**：
- **上行**：远程控制指令（启动/停止任务）、设置修改、查询请求
- **下行**：实时状态推送（PC端状态）、任务通知、执行日志、统计数据

**移动端 ↔ PC端（通过云端中转）**：
- 移动端发送控制指令 → 云端 → PC端执行
- PC端上报状态 → 云端 → 移动端实时显示
- 支持跨网络环境，无需PC和手机在同一局域网

---

## 4. PC端功能需求

### 4.1 账号与安全

#### 4.1.1 用户认证
- **账号密码登录**: 支持邮箱/用户名 + 密码登录
- **第三方登录**: 微信扫码、Google账号（海外版）
- **Token管理**: JWT Token自动刷新，支持多设备登录
- **会话管理**: 保持登录状态，异地登录提醒

#### 4.1.2 应用绑定
- **第三方应用集成**: 支持与桌面应用集成（企业微信、钉钉、Slack等）
- **应用检测**: 
  - macOS：通过Bundle ID和应用路径检测
  - Windows：通过进程名和注册表信息检测
- **应用连接配置**: 支持API Token、Webhook等连接方式
- **身份验证**: 验证应用连接的有效性和安全性

#### 4.1.3 数据安全
- **本地加密存储**: 敏感配置AES-256加密
- **密钥管理**: 系统凭据存储（Keychain/Credential Manager）
- **数据传输加密**: WebSocket/HTTPS加密传输
- **操作审计日志**: 记录所有关键操作，支持导出

#### 4.1.4 权限系统
- **角色权限**: 用户角色与权限管理
- **功能权限**: 细粒度功能访问控制
- **工具审批**: 敏感工具调用需人工审批
- **数据权限**: 数据访问范围控制

---

### 4.2 工作流设计中心 (Studio)

#### 4.2.1 可视化画布
- **无限画布**: 支持拖拽、缩放、平移的无限大画布
- **网格背景**: 可选的网格对齐功能
- **小地图导航**: 在复杂工作流中快速定位
- **画布操作**: 
  - 撤销/重做（Undo/Redo）
  - 复制/粘贴节点
  - 批量选择和移动
  - 节点对齐和分布
  - 框选多个节点

#### 4.2.2 节点库（23种节点类型）

**UI自动化节点（7种）**
1. **Click（点击）**: 单击、双击、右键，支持修饰键和偏移量
2. **Input（输入）**: 文本输入，支持清空、输入速度控制、回车确认
3. **Drag & Drop（拖拽）**: 元素拖拽，支持元素到元素、元素到位置
4. **Scroll（滚动）**: 上下左右滚动，支持滚动到指定元素
5. **Hover（悬停）**: 鼠标悬停，支持悬停时长和偏移量
6. **Keyboard（键盘）**: 键盘按键，支持修饰键和组合键
7. **Delay（延迟）**: 固定时长延迟等待

**流程控制节点（3种）**
8. **Variable（变量操作）**: 设置、获取、递增、追加、清除变量
9. **Compare（比较）**: 条件比较，支持多种运算符（==、!=、>、<、contains等）
10. **Data Extract（数据提取）**: 从元素、页面、剪贴板提取数据，支持正则、表格、列表提取

**集成节点（3种）**
11. **HTTP Request（HTTP请求）**: GET、POST等请求，支持Headers、Body、Query参数
12. **MCP Tool（MCP工具调用）**: 调用MCP协议工具
13. **Subworkflow（子工作流）**: 调用其他工作流，支持参数映射

**文件操作节点（2种）**
14. **File Selector（文件选择器）**: 打开文件选择对话框，支持单选、多选、文件夹
15. **File Operation（文件操作）**: 读写、复制、移动、删除文件

**系统操作节点（3种）**
16. **Clipboard（剪贴板）**: 读写剪贴板，支持文本、图片、HTML
17. **Shell Command（Shell命令）**: 执行系统命令，支持工作目录、环境变量
18. **App Control（应用控制）**: 启动、退出、激活、隐藏应用

**时间操作节点（1种）**
19. **DateTime（日期时间）**: 获取、格式化、计算日期时间

**AI操作节点（2种）**
20. **AI Process（AI处理）**: 文本生成、分类、情感分析、提取、翻译、OCR
21. **AI Call（AI通话）**: 启动/停止AI通话，配置ASR、TTS、对话参数

**通知节点（1种）**
22. **Notification（通知发送）**: 发送系统通知、企业微信、钉钉、Slack通知

**Agent调用节点（1种）**
23. **Agent Call（调用Agent）**: 调用Agent执行任务，支持会话管理、知识库绑定

#### 4.2.3 节点配置面板
- **基本属性**: 节点名称、描述、图标、颜色
- **元素定位**: 配置目标元素定位策略（AXUI、OCR、Image、Position）
- **操作参数**: 详细的操作参数配置
- **错误处理**: 失败时的处理策略（停止/继续/重试/跳转）
- **条件执行**: 基于变量的条件判断
- **截图配置**: 执行前后截图用于调试

#### 4.2.4 元素定位策略
- **AXUI定位**: 
  - macOS：基于Accessibility API（Role、Title、Identifier）
  - Windows：基于UI Automation（ControlType、Name、AutomationId）
- **OCR定位**: 基于OCR文字识别，支持模糊匹配
- **Image定位**: 基于图像模板匹配
- **Position定位**: 基于屏幕坐标（兜底方案）
- **策略优先级**: 支持配置多个定位策略，按优先级依次尝试
- **超时和重试**: 可配置超时时间和重试次数

#### 4.2.5 工作流属性
- **基本信息**: 名称、描述、分类、标签、图标
- **版本管理**: 版本号、更新日志、版本对比
- **系统要求**: 操作系统、目标应用、权限要求
- **参数定义**: 输入参数配置（类型、默认值、是否必填）
- **触发器配置**: 定时触发、通知触发、Webhook触发
- **AI配置**: 是否允许AI调用、工具描述、调用示例

#### 4.2.6 工作流管理
- **工作流列表**: 
  - 分类筛选、标签筛选、状态筛选
  - 搜索工作流名称和描述
  - 按更新时间、执行次数、成功率排序
- **工作流操作**: 
  - 新建、编辑、复制、删除
  - 导出/导入（JSON格式）
  - 发布/取消发布、归档
- **兼容性检查**: 
  - 自动检测操作系统兼容性
  - 检测目标应用是否安装
  - 验证所需权限是否授予
  - 显示兼容性状态和解决建议
- **快速适配**: 
  - 适配向导引导重新录制不兼容节点
  - 元素重定位更新定位器
  - 适配不同版本应用

---

### 4.3 智能录制器

#### 4.3.1 录制功能
- **一键启动**: 全局悬浮窗或快捷键启动/停止录制
- **暂停/恢复**: 支持录制过程中暂停和恢复
- **操作捕获**: 自动捕获点击、输入、拖拽、滚动等操作
- **元素捕获**: 记录操作的目标元素及其定位信息
- **生成工作流**: 将录制的操作自动转换为工作流节点

#### 4.3.2 实时元素高亮
- **Overlay Window**: 透明覆盖层窗口用于元素高亮
- **Hover高亮**: 鼠标悬停时高亮元素边框（黄色）
- **Selected状态**: 选中元素时显示蓝色边框
- **Confirmed状态**: 确认元素时显示绿色边框
- **多选支持**: 支持选择多个元素批量操作
- **自定义样式**: 可自定义高亮边框颜色、宽度、样式

**技术实现细节**：

1. **叠加窗口（Overlay Window）创建**：
   - 用户点击"录制"后，Tauri创建一个无边框、全屏、透明、置顶的叠加窗口
   - 窗口属性：`decorations: false`、`transparent: true`、`always_on_top: true`、`fullscreen: true`
   - 通过`set_ignore_cursor_events(true)` API设置为**鼠标事件可穿透**，不影响用户正常操作底层应用

2. **实时元素识别与高亮流程**：
   ```
   用户移动鼠标
        ↓
   Python引擎的pynput线程捕获鼠标坐标
        ↓
   调用pywinauto/pyobjc获取指针下方的UI元素
        ↓
   提取元素的屏幕矩形坐标（x, y, width, height）
        ↓
   通过Tauri事件系统发送到前端叠加窗口
        ↓
   叠加窗口中的JavaScript实时更新div元素的CSS样式
        ↓
   在目标元素上"画"出高亮边框
   ```

3. **元素选择确认**：
   - 用户点击鼠标或按下特定快捷键（如Enter）确认选择
   - Python引擎记录该元素的选择器信息：
     - macOS：Role、Title、Identifier、AXPath
     - Windows：ControlType、Name、AutomationId、Path
   - 生成稳定的元素定位器，完成一步录制

4. **性能优化**：
   - 元素识别采用节流机制（throttle），避免过度频繁的API调用
   - 高亮边框更新使用requestAnimationFrame，确保流畅动画
   - 缓存已识别的元素信息，减少重复查询

#### 4.3.3 智能选择器
- **稳定定位**: 保存元素的内在属性（文本、ID、角色）而非屏幕坐标
- **自适应**: 窗口大小、位置、分辨率变化时依然能准确找到元素
- **多策略组合**: 自动生成多个备选定位策略，提高成功率
- **定位器优化**: 按可靠性排序定位策略，优先使用最可靠的方式

#### 4.3.4 浏览器情境感知
- **Web录制模式**: 检测到浏览器操作时自动切换到Web录制
- **登录状态保持**: 支持持久化浏览器上下文，保持登录状态
- **跨域支持**: 支持跨域名的Web自动化流程
- **浏览器兼容**: 支持Chrome、Edge、Firefox、Safari

#### 4.3.5 录制模式
- **全自动录制**: 自动捕获所有操作，无需手动确认
- **手动录制**: 手动点击确认每个操作，精确控制
- **智能识别**: 自动识别操作类型（点击、输入、拖拽等）

---
