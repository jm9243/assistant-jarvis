# 助手-贾维斯 PRD · 迭代03：知识治理与执行体系

> 覆盖第4.8-4.14章，聚焦知识库、工具治理、执行与监控、系统扫描、MCP 集成与远程触发能力。

### 4.8 知识库与记忆系统

#### 4.8.1 知识库管理
- **知识库创建**: 设置名称、描述、嵌入模型、分块策略
- **文档管理**: 
  - 上传（拖拽、批量）
  - 支持格式：PDF、DOCX、XLSX、TXT、MD、HTML、PPT
  - 文档列表、预览、下载、删除
  - 文档状态：待处理、向量化中、已完成、失败
- **向量化处理**: 
  - 自动向量化
  - 存储到向量数据库
  - 分块预览
- **检索测试**: 
  - 输入查询测试检索效果
  - 查看检索结果和相似度得分
  - 调试信息
- **统计分析**: 文档数量、向量数量、检索次数、平均相似度

#### 4.8.2 记忆系统
- **短期记忆**: 
  - 当前对话上下文
  - 滑动窗口机制
  - 自动摘要压缩
  - 会话隔离
- **长期记忆**: 
  - 跨会话记忆
  - 知识提取
  - 话题分类
  - 记忆快照
  - 云端同步
- **工作记忆**: 
  - 任务状态
  - 临时变量
  - 中间结果
  - 上下文引用
- **记忆管理**: 
  - 记忆列表
  - 搜索、编辑、删除
  - 导出记忆数据

#### 4.8.3 RAG（检索增强生成）
- **检索策略**: 
  - 向量检索（语义）
  - 关键词检索（BM25）
  - 混合检索
  - Top-K配置
- **Rerank重排序**: 
  - 二次精细排序
  - 专用Rerank模型
  - 相关性提升
- **引用管理**: 
  - 标记引用来源
  - 显示引用片段
  - 溯源链接
  - 置信度显示

---

### 4.9 工具与治理

#### 4.9.1 工具商店
- **工具浏览**: 
  - 按类别浏览（Workflow、MCP、HTTP、Custom）
  - 工具搜索和标签筛选
  - 工具详情查看
- **工具管理**: 
  - 工具注册、编辑、删除
  - 工具启用/禁用
- **工具权限**: 
  - 审批策略配置
  - 审批人设置
  - 审计通道
  - 速率限制

#### 4.9.2 工具审批对话框
- **审批流程**: 
  - 审批请求触发
  - 显示工具信息（名称、参数、原因）
  - 批准/拒绝操作
  - 审批记录
- **自动审批规则**: 
  - 信任Agent自动批准
  - 白名单工具无需审批
  - 基于参数值的自动审批

#### 4.9.3 运营治理面板
- **KPI指标**: 
  - Agent调用量、工具调用量、工作流执行量
  - 成功率、平均响应时间
  - Token消耗、用户满意度
- **趋势分析**: 
  - 调用趋势、性能趋势、错误趋势
  - 对比分析
- **工具调用审计**: 
  - 调用记录详情
  - 调用时间、调用者、参数、结果
  - 执行时长、审批状态
- **告警管理**: 
  - 告警规则配置
  - 告警通知
  - 告警历史

---

### 4.10 工作流执行与任务管理

#### 4.10.1 工作流执行
- **手动执行**: 手动触发工作流
- **参数输入**: 填写工作流参数
- **参数记忆**: 记住上次输入
- **参数模板**: 保存常用参数组合
- **实时日志**: 查看实时执行日志
- **进度显示**: 显示执行进度百分比
- **暂停/恢复**: 支持暂停和恢复
- **终止执行**: 强制终止工作流

#### 4.10.2 执行状态
- Pending（等待执行）
- Running（执行中）
- Paused（已暂停）
- Completed（执行成功）
- Failed（执行失败）
- Cancelled（已取消）

#### 4.10.3 执行结果
- **节点结果**: 每个节点的执行结果
- **变量快照**: 各作用域变量的最终值
- **截图记录**: 节点执行前后的截图
- **执行时长**: 总时长和每个节点时长
- **错误信息**: 失败节点的错误详情

#### 4.10.4 任务队列
- **任务管理**: 
  - 任务列表、筛选、排序、搜索
  - 批量操作（执行、取消、删除）
- **任务优先级**: High（高）、Medium（中）、Low（低）
- **任务操作**: 
  - 立即执行（跳过队列）
  - 取消任务
  - 重试任务
  - 查看详情和日志

#### 4.10.5 工作流触发器
- **通知触发**: 系统通知触发工作流
  - 通知来源：企业微信、微信、系统
  - 关键词匹配（OR关系）
  - 排除关键词
  - 发送人过滤
  - 优先级配置
- **定时触发**: 按计划定时执行（规划中）
- **Webhook触发**: 外部Webhook调用（规划中）
- **消息触发**: 消息事件触发（规划中）

---

### 4.11 系统监控与管理

#### 4.11.1 系统信息
- **基础信息**: 操作系统、系统架构、Node版本、Electron版本、应用版本
- **实时监控**: CPU使用率、内存使用、磁盘使用、网络状态

#### 4.11.2 日志管理
- **日志记录**: 
  - 日志级别：Debug、Info、Warn、Error
  - 日志分类：系统、任务、消息、通话、错误
  - 日志格式：时间戳、级别、模块、消息
  - 日志轮转
- **日志查看**: 
  - 实时日志输出
  - 按级别、分类、关键词筛选
  - 搜索和导出
- **日志上报**: 
  - 定期上报到服务器
  - 错误立即上报
  - 异常捕获

#### 4.11.3 通知管理
- **系统通知**: 
  - 任务接收通知
  - AI暂停通知
  - 任务失败通知
  - 声音提示
- **通知中心**: 
  - 通知列表
  - 未读标记
  - 通知操作（跳转相关页面）
  - 通知清理

#### 4.11.4 文件下载管理
- **下载功能**: 
  - 从服务器下载文件
  - 下载进度显示
  - 断点续传
  - 下载历史
- **下载管理**: 
  - 暂停/恢复
  - 取消下载
  - 打开文件/文件夹

#### 4.11.5 更新服务
- **自动更新**: 
  - 检查更新
  - 更新提示
  - 下载更新
  - 安装更新并重启
- **更新配置**: 
  - 自动检查开关
  - 更新通道（Stable、Beta、Dev）
  - 静默更新
  - 强制更新

---

### 4.12 系统软件扫描

#### 4.12.1 扫描能力（跨平台）
**macOS扫描**:
- 扫描路径：/Applications、~/Applications、/System/Applications
- Info.plist解析
- system_profiler系统工具
- 应用信息：Bundle ID、名称、版本、路径、图标

**Windows扫描**:
- WMI查询：Win32_Product
- 注册表扫描：HKLM/HKCU Uninstall路径
- 开始菜单扫描
- 应用信息：显示名称、发布者、版本、路径、可执行文件名

**通用能力**:
- 进程名猜测
- 版本解析（semver）
- 缓存机制

#### 4.12.2 兼容性推荐
- 自动匹配工作流的目标应用
- 推荐兼容的工作流
- 版本匹配检查（semver范围）
- 跨平台提示

---

### 4.13 MCP Tool集成

#### 4.13.1 MCP服务器管理
- **连接MCP Server**: 配置服务器连接
- **工具发现**: 自动发现MCP工具
- **工具列表**: 查看所有可用工具

#### 4.13.2 工作流注册为MCP Tool
- **自动注册**: 将工作流注册为MCP Tool
- **工具定义生成**: 自动生成Tool Definition
- **描述生成**: 根据工作流信息生成AI描述
- **参数映射**: 工作流参数映射为Tool Parameters
- **AI调用**: AI可以调用工作流

#### 4.13.3 AI调用配置
- **启用AI调用**: 开关工作流的AI调用能力
- **工具名称**: 自定义工具名称
- **AI描述**: 供AI理解的描述
- **AI示例**: 提供调用示例
- **参数描述**: 每个参数的详细说明
- **速率限制**: 限制调用频率
- **需要确认**: 是否需要用户确认

---

### 4.14 WebSocket远程触发

#### 4.14.1 远程执行
- **执行命令**: 服务器通过WebSocket下发工作流执行命令
- **参数传递**: 远程传递工作流参数
- **异步执行**: 工作流异步执行，不阻塞WebSocket
- **执行响应**: 返回执行ID和初始状态

#### 4.14.2 状态同步
- **状态更新**: 实时推送工作流执行状态
- **进度报告**: 报告执行进度
- **结果上报**: 执行完成后上报结果
- **错误报告**: 执行失败时报告错误信息

---
