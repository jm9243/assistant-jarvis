# 助手-贾维斯 PRD · 迭代04：多端功能与技术架构

> 覆盖第5-7章，聚焦移动端、管理后台功能以及整体技术架构。

## 5. 移动端功能需求

### 5.1 产品定位

移动端作为PC端的监控和管理工具，主要功能是：
- 实时监控PC端工作流和Agent执行状态
- 远程控制PC端任务
- 接收通知和告警
- 查看统计报表
- 随时随地管理"贾维斯"

**注意**: 移动端不执行复杂的自动化任务，所有任务执行均在PC端完成。

### 5.2 核心功能模块

#### 5.2.1 首页仪表盘
- **实时状态**: 
  - PC在线状态（在线/离线）
  - 当前执行的任务数量
  - 今日执行任务数、成功率
  - 当前通话状态
- **快速操作**: 
  - 远程执行常用工作流
  - 暂停/恢复PC端任务
  - 查看最新通知
- **统计卡片**: 
  - 本周任务执行趋势图
  - Agent调用次数
  - 通话时长统计

#### 5.2.2 实时监控
- **PC设备列表**: 
  - 查看所有已登录的PC设备
  - 设备在线状态
  - 设备基本信息（操作系统、版本、IP）
  - 切换监控的设备
- **执行中任务**: 
  - 实时显示正在执行的工作流
  - 执行进度百分比
  - 当前执行节点
  - 实时日志流
- **暂停/终止**: 
  - 远程暂停任务
  - 远程终止任务
  - 确认对话框防误操作

#### 5.2.3 任务管理
- **任务列表**: 
  - 等待中任务
  - 执行历史记录
  - 按状态筛选（Pending、Running、Completed、Failed、Cancelled）
  - 按时间排序
- **任务操作**: 
  - 远程触发工作流执行
  - 填写工作流参数（表单式）
  - 取消等待中的任务
  - 重试失败的任务
- **任务详情**: 
  - 查看任务详细信息
  - 执行日志
  - 节点执行结果
  - 截图查看
  - 变量快照

#### 5.2.4 通话记录
- **通话列表**: 
  - 所有AI接听的通话记录
  - 按时间倒序排列
  - 显示来电人、时长、挂断原因
- **通话详情**: 
  - 完整对话文字记录
  - 通话摘要
  - 通话时长
  - 关键信息提取（姓名、电话、诉求）
- **筛选和搜索**: 
  - 按日期筛选
  - 按来电人搜索
  - 按关键词搜索对话内容

#### 5.2.5 通知中心
- **通知列表**: 
  - 所有通知按时间倒序
  - 未读标记
  - 通知类型图标（任务、通话、系统、告警）
- **通知详情**: 
  - 查看通知详细内容
  - 快速跳转到相关页面
- **通知设置**: 
  - 开启/关闭推送通知
  - 选择接收的通知类型
  - 免打扰时间段

#### 5.2.6 Agent管理
- **Agent列表**: 
  - 查看所有Agent
  - Agent状态（在线/离线/执行中）
  - Agent基本信息
- **Agent操作**: 
  - 启动/停止Agent
  - 查看Agent执行历史
  - 查看Agent性能指标
- **会话管理**: 
  - 与Agent进行对话
  - 查看会话历史
  - 发送文本、图片、文件

#### 5.2.7 工作流管理
- **工作流列表**: 
  - 查看所有工作流
  - 按分类、标签筛选
  - 搜索工作流
- **工作流详情**: 
  - 查看工作流基本信息
  - 查看工作流节点（简化展示）
  - 执行历史统计
- **远程执行**: 
  - 选择工作流
  - 填写参数（表单式）
  - 触发PC端执行
  - 查看执行进度

#### 5.2.8 统计报表
- **任务统计**: 
  - 今日/本周/本月执行任务数
  - 成功率趋势图
  - 执行时长统计
  - 失败原因分析
- **通话统计**: 
  - 通话次数和时长
  - 接通率
  - 平均通话时长
  - 来电人分布
- **Agent统计**: 
  - Agent调用次数
  - Token消耗统计
  - 响应时间分析
  - 成功率统计
- **导出报表**: 
  - 生成PDF/Excel报表
  - 分享报表

#### 5.2.9 设置
- **账号管理**: 
  - 查看账号信息
  - 修改密码
  - 退出登录
- **设备管理**: 
  - 查看已登录设备
  - 解绑设备
  - 设备授权管理
- **通知设置**: 
  - 推送通知开关
  - 通知类型选择
  - 免打扰时间
- **数据同步**: 
  - 同步设置
  - 数据使用统计
- **关于**: 
  - 版本信息
  - 用户协议
  - 隐私政策
  - 帮助中心

### 5.3 用户交互设计

#### 5.3.1 导航结构
- **底部Tab栏**: 
  - 首页（仪表盘）
  - 任务（任务管理）
  - 通话（通话记录）
  - 通知（通知中心）
  - 我的（设置）

#### 5.3.2 实时更新
- **WebSocket连接**: 与云端保持长连接，实时推送状态更新
- **推送通知**: 关键事件触发系统推送通知
- **自动刷新**: 任务状态、执行进度自动刷新

#### 5.3.3 离线处理
- **离线提示**: PC离线时显示明确提示
- **缓存数据**: 缓存历史数据，离线也可查看
- **操作队列**: 离线时的操作加入队列，上线后执行

---

## 6. 管理后台功能需求

### 6.1 产品定位

管理后台是面向企业管理员、平台运营者的Web管理系统，主要功能：
- 用户管理和权限控制
- 数据存储和备份
- 模板市场管理
- 付费和会员管理
- 模型管理
- 运营数据分析

### 6.2 核心功能模块

#### 6.2.1 用户管理

**用户列表**
- **用户信息**: 
  - 用户ID、用户名、邮箱、手机号
  - 注册时间、最后登录时间
  - 会员等级、到期时间
  - 账号状态（正常/冻结/注销）
- **筛选和搜索**: 
  - 按会员等级筛选
  - 按注册时间筛选
  - 按账号状态筛选
  - 搜索用户名、邮箱、手机号
- **批量操作**: 
  - 批量发送消息
  - 批量调整会员等级
  - 批量导出

**用户详情**
- **基本信息**: 
  - 查看和编辑用户基本信息
  - 修改密码
  - 调整会员等级
- **设备管理**: 
  - 查看用户已登录的设备
  - 强制下线设备
  - 查看设备活跃情况
- **使用统计**: 
  - 工作流执行次数
  - Agent调用次数
  - Token消耗量
  - 存储空间使用
- **付费记录**: 
  - 查看充值记录
  - 查看购买记录
  - 查看消费记录
- **操作日志**: 
  - 查看用户操作日志
  - 敏感操作记录
  - 异常行为记录

**用户操作**
- **冻结账号**: 冻结违规账号
- **解冻账号**: 解除冻结
- **重置密码**: 管理员重置用户密码
- **发送消息**: 向用户发送系统消息
- **调整配额**: 调整用户的使用配额（存储、Token等）

#### 6.2.2 权限管理

**角色管理**
- **预设角色**: 
  - 超级管理员：所有权限
  - 运营管理员：用户管理、内容管理
  - 财务管理员：付费数据查看
  - 审核管理员：模板审核
  - 客服：查看用户信息、处理工单
- **自定义角色**: 
  - 创建自定义角色
  - 配置角色权限
  - 删除角色

**权限配置**
- **功能权限**: 
  - 用户管理（查看/编辑/删除）
  - 模板管理（查看/审核/下架）
  - 财务管理（查看/导出）
  - 系统设置（查看/修改）
- **数据权限**: 
  - 查看所有用户数据
  - 查看部门用户数据
  - 仅查看自己的数据

**管理员账号**
- **管理员列表**: 查看所有管理员
- **添加管理员**: 创建新管理员账号
- **分配角色**: 为管理员分配角色
- **操作日志**: 查看管理员操作日志

#### 6.2.3 数据管理

**数据存储**
- **存储统计**: 
  - 总存储空间使用量
  - 各类型数据占比（工作流、知识库、通话记录等）
  - 用户存储空间排行
- **存储配置**: 
  - 默认存储配额
  - 会员存储配额
  - 存储扩容设置
- **数据清理**: 
  - 清理过期数据
  - 清理临时文件
  - 释放存储空间

**数据备份**
- **备份策略**: 
  - 自动备份时间配置
  - 备份保留周期
  - 增量备份/全量备份
- **备份记录**: 
  - 查看所有备份记录
  - 备份时间、大小、状态
- **备份操作**: 
  - 立即执行备份
  - 恢复到指定备份
  - 下载备份文件
  - 删除备份

**数据导出**
- **用户数据导出**: 导出用户列表、统计数据
- **业务数据导出**: 导出工作流、Agent、通话记录等
- **财务数据导出**: 导出订单、流水等
- **格式支持**: CSV、Excel、JSON

#### 6.2.4 模板市场管理

**工作流模板管理**
- **模板列表**: 
  - 所有工作流模板
  - 模板信息：名称、描述、创建者、价格、销量
  - 模板状态：待审核、已上架、已下架、已拒绝
- **模板审核**: 
  - 查看模板详情
  - 预览工作流节点
  - 审核意见填写
  - 批准/拒绝操作
- **模板分类**: 
  - 创建/编辑/删除分类
  - 分类排序
  - 热门分类设置
- **模板标签**: 
  - 创建/编辑/删除标签
  - 标签管理
- **模板操作**: 
  - 设置推荐
  - 设置热门
  - 调整价格
  - 下架模板

**Agent模板管理**
- **模板列表**: 
  - 所有Agent模板
  - 模板信息：名称、描述、创建者、价格、销量
  - 模板状态：待审核、已上架、已下架、已拒绝
- **模板审核**: 
  - 查看Agent配置详情
  - 测试Agent对话效果
  - 审核意见填写
  - 批准/拒绝操作
- **模板分类**: 
  - 客服类、分析类、创作类、研究类、协作类
  - 自定义分类
- **模板操作**: 
  - 设置推荐
  - 设置热门
  - 调整价格
  - 下架模板

**模板统计**
- **销售统计**: 
  - 总销售额
  - 销量排行榜
  - 销售趋势图
  - 热门模板分析
- **用户行为**: 
  - 浏览量统计
  - 下载量统计
  - 收藏量统计
  - 转化率分析
- **创作者统计**: 
  - 创作者收益排行
  - 模板数量统计
  - 平均评分

#### 6.2.5 付费与会员管理

**会员体系**
- **会员等级**: 
  - 免费版：基础功能，有配额限制
  - 个人版：完整功能，较高配额
  - 专业版：高级功能，无限配额
  - 企业版：团队协作，企业级支持
- **会员权益**: 
  - 工作流执行次数配额
  - Agent调用次数配额
  - Token使用配额
  - 存储空间配额
  - 知识库文档数量
  - 并发任务数量
  - 模板下载数量
  - 技术支持等级
- **会员价格**: 
  - 月付/年付价格设置
  - 优惠折扣配置
  - 促销活动设置

**订单管理**
- **订单列表**: 
  - 所有订单记录
  - 订单信息：订单号、用户、商品、金额、状态
  - 订单状态：待支付、已支付、已取消、已退款
- **订单筛选**: 
  - 按时间筛选
  - 按订单状态筛选
  - 按商品类型筛选（会员、模板、Token）
  - 按金额范围筛选
- **订单详情**: 
  - 查看订单详细信息
  - 支付信息
  - 发票信息
- **订单操作**: 
  - 手动确认订单
  - 订单退款
  - 取消订单
  - 导出订单

**支付管理**
- **支付渠道**: 
  - 微信支付
  - 支付宝
  - 信用卡支付（海外）
  - PayPal（海外）
- **支付配置**: 
  - 支付渠道开关
  - 支付参数配置
  - 支付回调配置
- **支付流水**: 
  - 查看所有支付流水
  - 支付时间、金额、渠道、状态
  - 对账功能

**退款管理**
- **退款申请**: 
  - 查看所有退款申请
  - 申请信息：用户、订单、原因、时间
  - 申请状态：待审核、已批准、已拒绝、已退款
- **退款审核**: 
  - 查看退款详情
  - 审核意见填写
  - 批准/拒绝操作
- **退款记录**: 
  - 所有退款记录
  - 退款金额统计

**发票管理**
- **发票申请**: 
  - 查看所有发票申请
  - 申请信息：用户、订单、抬头、税号
  - 申请状态：待开具、已开具、已邮寄
- **发票开具**: 
  - 开具电子发票
  - 开具纸质发票
  - 发票邮寄管理
- **发票记录**: 
  - 所有发票记录
  - 发票查询和下载

#### 6.2.6 模型管理

**模型配置**
- **LLM模型管理**: 
  - 支持的模型列表（OpenAI、Claude、Coze、本地模型）
  - 模型API配置
  - 模型参数配置（Temperature、Max Tokens等）
  - 模型启用/禁用
- **嵌入模型管理**: 
  - 向量化模型列表
  - 模型维度配置
  - 模型性能配置
- **模型优先级**: 
  - 设置默认模型
  - 配置模型降级策略
  - 负载均衡配置

**模型调用统计**
- **调用量统计**: 
  - 各模型调用次数
  - Token消耗统计
  - 调用趋势图
- **成本分析**: 
  - 各模型成本统计
  - 用户成本排行
  - 成本趋势分析
- **性能监控**: 
  - 响应时间统计
  - 成功率统计
  - 错误率分析

**模型配额管理**
- **全局配额**: 
  - 设置平台总配额
  - 各模型分配配额
- **用户配额**: 
  - 免费用户配额
  - 付费用户配额
  - 企业用户配额
- **配额预警**: 
  - 配额使用预警
  - 超额使用告警

#### 6.2.7 运营数据分析

**用户数据**
- **用户增长**: 
  - 新增用户趋势图
  - 累计用户数
  - 用户增长率
- **用户活跃**: 
  - 日活跃用户（DAU）
  - 月活跃用户（MAU）
  - 用户留存率（次日、7日、30日）
- **用户画像**: 
  - 用户地域分布
  - 用户操作系统分布
  - 用户会员等级分布

**业务数据**
- **工作流数据**: 
  - 工作流创建数量
  - 工作流执行次数
  - 工作流成功率
  - 热门工作流排行
- **Agent数据**: 
  - Agent创建数量
  - Agent调用次数
  - Agent类型分布
  - 热门Agent排行
- **通话数据**: 
  - 通话总次数
  - 通话总时长
  - 平均通话时长
  - 接通率统计

**财务数据**
- **收入统计**: 
  - 总收入
  - 收入趋势图
  - 收入来源分析（会员、模板、Token）
- **用户价值**: 
  - ARPU（每用户平均收入）
  - LTV（用户生命周期价值）
  - 付费转化率
- **模板市场**: 
  - 模板销售额
  - 平台抽成收入
  - 创作者收益

**系统数据**
- **资源使用**: 
  - 服务器资源使用情况
  - 存储空间使用情况
  - 带宽使用情况
- **性能指标**: 
  - API响应时间
  - 任务执行成功率
  - 系统可用性
- **错误监控**: 
  - 错误次数统计
  - 错误类型分布
  - 错误趋势分析

#### 6.2.8 内容管理

**公告管理**
- **公告列表**: 查看所有公告
- **创建公告**: 
  - 公告标题、内容
  - 公告类型（系统维护、功能更新、活动通知）
  - 发布时间、结束时间
  - 目标用户（全部/指定会员等级）
- **公告操作**: 
  - 编辑公告
  - 删除公告
  - 置顶公告

**帮助文档**
- **文档分类**: 
  - 快速入门
  - 功能教程
  - 常见问题
  - API文档
- **文档管理**: 
  - 创建/编辑/删除文档
  - 文档排序
  - 文档搜索
- **文档统计**: 
  - 文档浏览量
  - 热门文档排行

**反馈管理**
- **反馈列表**: 
  - 所有用户反馈
  - 反馈类型：Bug、功能建议、使用问题、其他
  - 反馈状态：待处理、处理中、已完成、已关闭
- **反馈处理**: 
  - 查看反馈详情
  - 回复用户
  - 标记状态
  - 分配处理人
- **反馈统计**: 
  - 反馈数量趋势
  - 反馈类型分布
  - 处理时效统计

#### 6.2.9 系统设置

**基础设置**
- **平台信息**: 
  - 平台名称、Logo
  - 联系方式
  - 备案信息
- **邮件配置**: 
  - SMTP服务器配置
  - 邮件模板管理
- **短信配置**: 
  - 短信服务商配置
  - 短信模板管理

**安全设置**
- **登录安全**: 
  - 密码强度要求
  - 登录失败限制
  - 多设备登录策略
- **API安全**: 
  - API密钥管理
  - 访问频率限制
  - IP白名单
- **数据安全**: 
  - 数据加密配置
  - 敏感数据脱敏
  - 审计日志保留期

**系统监控**
- **服务状态**: 
  - 各服务运行状态
  - 服务健康检查
- **告警配置**: 
  - 告警规则配置
  - 告警通知渠道
  - 告警接收人
- **日志管理**: 
  - 系统日志查看
  - 日志筛选和搜索
  - 日志导出

---

## 7. 技术架构概览

### 7.1 PC端核心架构（驾驶舱与引擎分离）

本架构的核心是**"驾驶舱与引擎分离"**的设计哲学，确保前端UI的流畅性和跨平台一致性，同时将复杂的自动化逻辑完全解耦到独立的后端引擎中。

```
+-----------------------------------------------------------------------------------+
|                                  用户交互层                                       |
|                    (工作流设计, 自然语言指令, 状态监控)                            |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (1) 用户操作/指令                          | (6) 结果/状态反馈
      v                                        |
+-----------------------------------------------------------------------------------+
|                      前端应用: 贾维斯驾驶舱 (Tauri 2 + React)                         |
|                                                                                   |
|  +--------------------------+  +--------------------------+  +------------------+  |
|  |   工作流设计器 (React Flow)  |  |      AI助理交互界面      |  |     系统设置     |  |
|  |   (包含用于高亮的叠加窗口)    |  |     (极简聊天/命令栏)     |  |     (React)      |  |
|  +--------------------------+  +--------------------------+  +------------------+  |
|                                                                                   |
|-----------------------------------------------------------------------------------|
|                      通信桥梁: Tauri Rust 核心                                    |
|              (管理Sidecar生命周期, 通过IPC或本地HTTP与引擎通信)                     |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (2) 格式化指令 (JSON)                   | (5) 实时事件/数据
      v                                        |
+-----------------------------------------------------------------------------------+
|                    核心引擎: Python Sidecar (独立可执行文件)                        |
|                                                                                   |
|  +-----------------------------------------------------------------------------+  |
|  |                    (A) 决策层: AI多智能体系统 (AgentScope)                    |  |
|  |  [主管Agent] -> [RPA Agent], [通信Agent], [分析Agent] ...                  |  |
|  |  (解析指令、任务规划、决策、调用下层工具)                                        |  |
|  +-----------------------------------------------------------------------------+  |
|  |                     (B) 能力层: 工具集 (Toolbox)                             |  |
|  |                                                                             |  |
|  | +-----------------+ +-------------------+ +---------------------------------+ |  |
|  | | GUI自动化工具   | | Web自动化工具     | | 系统级集成工具                  | |  |
|  | | - pywinauto     | | - Playwright      | | - 通知监听 (winrt-notifications) | |  |
|  | | - pyobjc        | | - OCR (Tesseract) | | - 虚拟音频 (VB-CABLE/BlackHole) | |  |
|  | | - 事件监听(pynput)| |                   | | - 虚拟摄像头 (pyvirtualcam)    | |  |
|  | +-----------------+ +-------------------+ +---------------------------------+ |  |
|  +-----------------------------------------------------------------------------+  |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (3) 底层API调用/脚本执行                  | (4) 从系统/应用捕获数据
      v                                        |
+-----------------------------------------------------------------------------------+
|                      操作系统与目标应用程序 (Windows/macOS)                         |
+-----------------------------------------------------------------------------------+
```

**架构说明**：

1. **前端应用（驾驶舱）**：
   - 使用Tauri 2框架，基于Rust后端和原生WebView
   - React构建的UI，负责所有用户交互
   - 包含透明叠加窗口用于元素高亮显示
   - 不执行任何自动化逻辑，仅负责呈现和交互

2. **通信桥梁（Tauri Rust核心）**：
   - 管理Python Sidecar进程的生命周期
   - 通过IPC或本地HTTP与后端引擎通信
   - 提供前端调用后端的安全接口

3. **核心引擎（Python Sidecar）**：
   - 使用PyInstaller打包为独立可执行文件
   - **决策层**：基于AgentScope的Multi-Agent系统
   - **能力层**：集成所有自动化工具和系统集成能力
   - 完全独立运行，不依赖前端

4. **关键技术选型理由**：
   - **AgentScope vs LangChain**：AgentScope专为多智能体应用设计，原生支持Agent协同和消息驱动通信
   - **Playwright**：支持持久化浏览器上下文（`launch_persistent_context`），完美解决登录状态保持问题
   - **pywinauto/pyobjc**：直接与操作系统辅助功能API交互，实现稳定可靠的元素定位
   - **pynput**：全局键鼠事件监听，是录制器的核心

### 7.2 三端整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户交互层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  PC客户端    │  │  移动端App   │  │  管理后台    │         │
│  │  (Tauri 2)   │  │(React Native)│  │  (React)     │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕ HTTPS/WebSocket
┌─────────────────────────────────────────────────────────────────┐
│                          API网关层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  负载均衡    │  │  API网关     │  │  鉴权中心    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────────┐
│                          业务服务层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  用户服务    │  │  工作流服务  │  │  Agent服务   │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  模板服务    │  │  支付服务    │  │  通知服务    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────────┐
│                          数据存储层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  PostgreSQL  │  │  MongoDB     │  │  Redis       │         │
│  │  (关系数据)  │  │  (文档数据)  │  │  (缓存)      │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  向量数据库  │  │  对象存储    │  │  消息队列    │         │
│  │  (Qdrant)    │  │  (OSS)       │  │  (RabbitMQ)  │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

### 7.2 PC端技术架构

**前端技术栈**
- **框架**: Tauri 2
- **UI库**: React 18
- **状态管理**: Zustand
- **工作流引擎**: React Flow
- **样式**: Tailwind CSS
- **图表**: ECharts
- **通信**: WebSocket、HTTP

**后端引擎（Python Sidecar）**
- **框架**: FastAPI
- **AI决策**: AgentScope
- **GUI自动化**: 
  - macOS: pyobjc
  - Windows: pywinauto
- **Web自动化**: Playwright
- **OCR**: Tesseract
- **音频**: pydub、sounddevice
- **打包**: PyInstaller

### 7.3 移动端技术架构

**技术栈**
- **框架**: React Native
- **状态管理**: Redux Toolkit
- **导航**: React Navigation
- **UI组件**: React Native Paper
- **图表**: react-native-chart-kit
- **推送**: Firebase Cloud Messaging (FCM)
- **本地存储**: AsyncStorage

### 7.4 后台界面技术架构

**技术栈**
- **框架**: React 18
- **UI组件**: Ant Design Pro
- **状态管理**: Redux Toolkit
- **路由**: React Router v6
- **图表**: ECharts
- **表格**: Ant Design Table
- **富文本**: Quill

### 7.5 后台服务技术架构

**后端技术栈**
- **语言**: Go
- **框架**: Gin / Fiber（轻量级高性能Web框架）
- **BaaS平台**: Supabase（提供数据库、认证、存储、实时订阅等一体化服务）
- **API文档**: Swagger
- **认证**: Supabase Auth（内置JWT认证）
- **实时通信**: Supabase Realtime（基于PostgreSQL的实时订阅）

**Supabase集成说明**

Supabase是一个开源的Firebase替代方案，提供完整的后端即服务（BaaS）能力。所有用户数据统一存储在我们的Supabase项目中。

**核心能力**：
- **PostgreSQL数据库**: 
  - 用户信息、工作流定义、Agent配置、订单数据、权限管理等
  - 支持复杂查询、事务、触发器
  - 内置Row Level Security（RLS）实现数据隔离
  
- **Supabase Auth**: 
  - 用户注册、登录、JWT Token管理
  - 支持邮箱密码、第三方OAuth（微信、Google等）
  - 自动处理Token刷新和会话管理
  
- **Supabase Storage**: 
  - 工作流模板文件、知识库文档、通话录音、用户头像等
  - 支持大文件上传、断点续传
  - 自动CDN加速
  
- **Supabase Realtime**: 
  - PC端与云端的实时状态同步
  - 移动端实时监控PC端任务执行
  - 基于PostgreSQL的LISTEN/NOTIFY机制
  
- **Edge Functions**: 
  - 部署轻量级Serverless函数处理特定业务逻辑
  - 如：支付回调、数据统计、定时任务等

**Go后端服务职责**：
- **API网关**: 统一的RESTful API入口，处理业务逻辑
- **业务编排**: 协调Supabase各服务，实现复杂业务流程
- **第三方集成**: 对接LLM服务、支付服务、推送服务等
- **性能优化**: 缓存、批量处理、异步任务队列
- **安全增强**: API限流、参数校验、敏感操作审计

**数据存储方案**：
- **PostgreSQL（Supabase内置）**: 
  - 用户、工作流、Agent、订单、权限、日志等结构化数据
  - 使用pgvector扩展实现向量存储（知识库）
  
- **Supabase Storage**: 
  - 文件、模板、文档、音频、图片等非结构化数据
  
- **Redis（可选）**: 
  - 高频访问数据缓存
  - 分布式锁
  - 任务队列（使用Go的Asynq库）

**第三方服务**
- **LLM服务**: OpenAI、Claude、Coze
- **语音服务**: 阿里云智能媒体服务
- **支付服务**: 微信支付、支付宝、Stripe
- **推送服务**: Firebase Cloud Messaging
- **监控服务**: Sentry、Prometheus

**技术优势**：
- ✅ **快速开发**: Supabase提供开箱即用的后端能力，减少基础设施搭建时间
- ✅ **高性能**: Go的高并发能力 + PostgreSQL的稳定性
- ✅ **统一管理**: 所有用户数据集中在一个Supabase项目中，便于管理和备份
- ✅ **实时能力**: Supabase Realtime原生支持，无需额外WebSocket服务器
- ✅ **成本可控**: 按需付费，初期成本低，支持平滑扩展
- ✅ **开源生态**: Supabase开源，可自托管，避免厂商锁定

---
