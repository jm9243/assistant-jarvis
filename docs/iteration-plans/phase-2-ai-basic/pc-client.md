# Phase 2: 三种Agent - PC端迭代计划

**阶段目标**: 引入AI能力，实现Basic、ReAct、Deep Research三种类型的Agent  
**预计时间**: 2.5个月  
**依赖**: Phase 1 工作流系统完成

---

## 目录

1. [功能清单](#功能清单)
2. [核心功能详解](#核心功能详解)
3. [技术架构](#技术架构)
4. [开发计划](#开发计划)
5. [验收标准](#验收标准)

---

## 功能清单

### 必须完成的功能模块

#### 1. Agent中心UI (对应PRD 4.4)
- [ ] Agent列表页面
- [ ] Agent创建/编辑页面
- [ ] Agent类型选择（Basic、ReAct、Deep Research）
- [ ] Agent配置界面
- [ ] Agent模板库
- [ ] Agent监控面板
- [ ] Agent调试工具
- [ ] Agent评估系统

#### 2. Basic Agent (对应PRD 4.4.1)
- [ ] 核心对话能力
- [ ] 模型选择与配置
- [ ] System Prompt配置
- [ ] 回复风格设定
- [ ] 多轮对话支持
- [ ] 对话历史管理

#### 3. ReAct Agent (对应PRD 4.4.1)
- [ ] Thought-Action-Observation循环
- [ ] 工具调用能力
- [ ] 多步推理
- [ ] 工具选择策略
- [ ] 思考链可见性
- [ ] 最大迭代次数控制

#### 4. Deep Research Agent (对应PRD 4.4.1)
- [ ] 任务自动拆解
- [ ] 多源信息检索
- [ ] 研究深度级别配置
- [ ] 信息源范围配置
- [ ] 可信度阈值
- [ ] 结构化报告生成

#### 5. 对话能力 (对应PRD 4.4.2)
- [ ] 会话管理（创建、列表、切换、删除、导出）
- [ ] 短期记忆系统
- [ ] 长期记忆系统
- [ ] 工作记忆系统
- [ ] 用户打断支持
- [ ] 多模态输入（文本、图片、文件）
- [ ] 流式输出
- [ ] 引用溯源

#### 6. 知识库集成 (对应PRD 4.4.3)
- [ ] 知识库创建与管理
- [ ] 文档上传（支持多种格式）
- [ ] 文档预处理与分块
- [ ] 向量化处理
- [ ] 向量检索
- [ ] 关键词检索
- [ ] 混合检索
- [ ] Rerank重排序
- [ ] 检索测试工具
- [ ] 统计分析

#### 7. 工具调用能力 (对应PRD 4.4.4)
- [ ] Workflow工具集成
- [ ] MCP工具集成
- [ ] HTTP API工具
- [ ] 系统工具
- [ ] 内置工具
- [ ] 工具调用流程（自动/审批/手动）
- [ ] 工具审批机制
- [ ] 工具调用历史

#### 8. AI助理"贾维斯" (对应PRD 4.6)
- [ ] 全局搜索框（Spotlight风格）
- [ ] 快捷键唤出
- [ ] 自然语言理解
- [ ] 任务规划
- [ ] 工作流调用
- [ ] 实时反馈
- [ ] 执行确认
- [ ] 上下文管理

#### 9. 工具商店 (对应PRD 4.9.1)
- [ ] 工具浏览界面
- [ ] 工具分类（Workflow、MCP、HTTP、Custom）
- [ ] 工具搜索与筛选
- [ ] 工具详情查看
- [ ] 工具注册管理
- [ ] 工具启用/禁用
- [ ] 工具权限配置

---

## 核心功能详解

### 1. Agent中心UI

#### 1.1 Agent列表页面
**功能描述**: 展示所有创建的Agent，支持筛选和搜索

**核心子功能**:
- Agent卡片展示（类型、名称、描述、状态）
- 按类型筛选（All、Basic、ReAct、Deep Research）
- 按状态筛选（Active、Inactive）
- 搜索Agent名称和描述
- 快速操作（启动/停止、编辑、删除）

**UI组件**:
- Agent卡片组件
- 筛选栏
- 搜索框
- 操作按钮组

---

#### 1.2 Agent创建/编辑页面
**功能描述**: 创建或编辑Agent配置

**核心子功能**:
- Agent类型选择（第一步）
- 基本信息配置（名称、描述、头像、标签）
- 模型配置
- Prompt配置
- 记忆配置
- 知识库绑定
- 工具绑定
- 权限配置

**UI布局**:
- 左侧：配置分组导航
- 中间：配置表单
- 右侧：实时预览/测试

---

#### 1.3 Agent模板库
**功能描述**: 提供预设的Agent模板，快速创建

**模板分类**:
- 客服类：智能客服、售前咨询、售后支持
- 分析类：数据分析师、报告生成器、趋势分析
- 创作类：文案助手、翻译助手、内容优化
- 研究类：学术研究、市场调研、竞品分析
- 协作类：项目管理、会议助手、知识管理

**功能**:
- 模板浏览
- 模板预览
- 从模板创建Agent
- 自定义模板保存

---

### 2. Basic Agent

#### 2.1 核心对话能力
**功能描述**: 基础的对话问答能力

**技术实现**:
- 调用LLM API（OpenAI、Claude、Coze）
- 支持流式输出
- 上下文管理（滑动窗口）
- Token计数和控制

**配置项**:
- 模型选择：
  - OpenAI: gpt-4-turbo, gpt-3.5-turbo
  - Claude: claude-3-opus, claude-3-sonnet
  - Coze: 自定义bot
- Temperature: 0-2（创造性控制）
- Max Tokens: 最大输出长度
- Top-P: 核采样参数
- Frequency Penalty: 频率惩罚
- Presence Penalty: 存在惩罚

---

#### 2.2 System Prompt配置
**功能描述**: 配置Agent的系统提示词

**核心子功能**:
- Prompt编辑器（支持Markdown）
- Prompt模板库
- Prompt变量（如{{username}}、{{date}}）
- Prompt测试工具

**最佳实践提示**:
- 明确角色定位
- 清晰的任务描述
- 输出格式要求
- 约束条件

---

### 3. ReAct Agent

#### 3.1 Thought-Action-Observation循环
**功能描述**: 实现推理-行动-观察的循环

**工作流程**:
```
用户输入问题
    ↓
Thought: Agent思考如何解决问题
    ↓
Action: 决定调用哪个工具及参数
    ↓
Observation: 观察工具执行结果
    ↓
(循环直到得出最终答案或达到最大迭代次数)
    ↓
Final Answer: 返回最终答案
```

**技术实现**:
- 使用特定的Prompt格式
- 解析Agent输出的Action
- 执行Action并获取Observation
- 将Observation追加到上下文
- 继续推理

**Prompt格式示例**:
```
You have access to the following tools:
- search: 搜索网络信息
- calculator: 执行数学计算
- workflow: 执行工作流

Use the following format:
Thought: 你对当前情况的思考
Action: 工具名称[参数]
Observation: 工具执行结果

Example:
Question: 北京今天天气如何？
Thought: 我需要搜索北京今天的天气信息
Action: search["北京今天天气"]
Observation: 北京今天晴，温度15-25℃
Thought: 我已经得到了答案
Final Answer: 北京今天天气晴朗，温度在15-25摄氏度之间。
```

---

#### 3.2 工具调用能力
**功能描述**: 调用外部工具执行任务

**支持的工具类型**:
1. **Workflow工具**: 调用Phase 1创建的工作流
2. **MCP工具**: 调用MCP协议工具
3. **HTTP API工具**: 调用外部HTTP API
4. **系统工具**: 文件操作、Shell命令
5. **内置工具**: 计算器、日期处理

**工具调用流程**:
```
Agent决定调用工具
    ↓
解析工具名称和参数
    ↓
检查工具权限（是否需要审批）
    ↓
如果需要审批 → 显示审批对话框 → 用户批准/拒绝
    ↓
执行工具
    ↓
返回执行结果（Observation）
    ↓
继续推理
```

**技术要点**:
- 工具定义使用JSON Schema格式
- 工具调用记录审计日志
- 支持工具调用超时控制
- 工具执行结果格式化

---

### 4. Deep Research Agent

#### 4.1 任务自动拆解
**功能描述**: 将复杂研究任务拆解为多个子任务

**工作流程**:
```
用户提出研究任务
    ↓
Agent分析任务复杂度
    ↓
拆解为多个子任务
    ↓
为每个子任务制定执行计划
    ↓
并行或顺序执行子任务
    ↓
汇总所有子任务结果
    ↓
生成最终研究报告
```

**拆解策略**:
- 按主题拆解
- 按信息源拆解
- 按时间维度拆解
- 按深度层级拆解

---

#### 4.2 多源信息检索
**功能描述**: 从多个信息源检索相关信息

**支持的信息源**:
- 知识库（向量检索）
- 网络搜索（通过工具）
- 本地文件
- API数据源
- 数据库查询

**检索策略**:
- 并行检索多个源
- 按相关性排序
- 去重和合并
- 可信度评估

---

#### 4.3 结构化报告生成
**功能描述**: 生成格式化的研究报告

**报告模板**:
- 执行摘要
- 研究方法
- 关键发现
- 详细分析
- 结论与建议
- 引用来源

**配置项**:
- 研究深度级别：快速/标准/深入
- 信息源范围：本地/网络/全部
- 可信度阈值：0-1
- 报告格式：Markdown/PDF/HTML

---

### 5. 对话能力

#### 5.1 会话管理
**功能描述**: 管理Agent的对话会话

**核心子功能**:
- **创建会话**: 为Agent创建新会话
- **列表查看**: 查看所有会话列表
- **切换会话**: 在不同会话间切换
- **删除会话**: 删除不需要的会话
- **导出会话**: 导出会话历史（JSON/TXT）
- **会话搜索**: 搜索会话内容

**会话信息**:
- 会话ID
- Agent ID
- 创建时间
- 最后活跃时间
- 消息数量
- 会话标题（自动生成或手动设置）

---

#### 5.2 记忆系统
**功能描述**: 管理Agent的记忆

**短期记忆**:
- 当前对话上下文
- 滑动窗口机制（保留最近N条消息）
- 自动摘要压缩（超出窗口时）
- 会话隔离（不同会话独立）

**长期记忆**:
- 跨会话记忆
- 用户偏好记忆
- 重要信息提取
- 话题分类存储
- 记忆快照
- 云端同步

**工作记忆**:
- 当前任务状态
- 临时变量存储
- 中间结果缓存
- 上下文引用

**记忆管理UI**:
- 记忆列表查看
- 记忆搜索
- 手动编辑记忆
- 删除记忆
- 导出记忆数据

---

#### 5.3 多模态输入
**功能描述**: 支持多种形式的输入

**支持类型**:
- **文本输入**: Markdown编辑器
- **图片输入**: 拖拽上传，支持OCR、图像理解
- **文件输入**: 上传文档，自动提取内容
- **语音输入**: 语音转文字（Phase 3集成）

**技术实现**:
- 图片上传到Storage
- 文件解析（支持PDF、DOCX、TXT等）
- 多模态融合理解

---

#### 5.4 流式输出与引用溯源
**功能描述**: 实时流式返回，显示引用来源

**流式输出**:
- 使用Server-Sent Events (SSE)
- 实时渲染Markdown
- 打字机效果
- 支持用户打断

**引用溯源**:
- 标记引用来源
- 显示引用片段
- 溯源链接（跳转到知识库文档）
- 置信度显示

---

### 6. 知识库集成

#### 6.1 知识库创建与管理
**功能描述**: 创建和管理知识库

**创建知识库**:
- 名称、描述
- 嵌入模型选择（OpenAI、Cohere、本地）
- 分块策略配置：
  - 分块大小（chunk_size）
  - 分块重叠（chunk_overlap）
  - 分隔符（separators）

**知识库管理**:
- 知识库列表
- 编辑知识库
- 删除知识库
- 知识库统计（文档数、向量数、存储大小）

---

#### 6.2 文档上传与处理
**功能描述**: 上传文档并自动处理

**支持格式**:
- PDF
- DOCX
- XLSX
- TXT
- MD
- HTML
- PPT

**上传方式**:
- 拖拽上传
- 批量上传
- 文件夹上传

**处理流程**:
```
文档上传
    ↓
文件解析（提取文本）
    ↓
文本分块
    ↓
向量化（调用Embedding API）
    ↓
存储到向量数据库
    ↓
完成
```

**文档状态**:
- 待处理
- 向量化中
- 已完成
- 失败（显示错误原因）

---

#### 6.3 检索策略
**功能描述**: 多种检索方式

**向量检索**:
- 语义相似度检索
- Top-K配置
- 相似度阈值
- 距离算法（余弦、欧氏等）

**关键词检索**:
- 全文搜索（BM25算法）
- 支持布尔查询
- 支持正则表达式

**混合检索**:
- 向量检索 + 关键词检索
- 加权融合
- 结果合并去重

**Rerank重排序**:
- 使用专用Rerank模型
- 二次精细排序
- 提升相关性

---

#### 6.4 检索测试工具
**功能描述**: 测试和优化检索效果

**核心功能**:
- 输入测试查询
- 查看检索结果
- 显示相似度得分
- 查看检索到的文档片段
- 调整参数并重新检索

**调试信息**:
- 检索耗时
- 向量化耗时
- 检索到的向量数量
- 排序后的Top-K结果

---

### 7. 工具调用能力

#### 7.1 Workflow工具集成
**功能描述**: 将Phase 1创建的工作流注册为工具

**自动注册**:
- 工作流创建时自动生成Tool定义
- 工具名称：workflow_{workflow_name}
- 工具描述：根据工作流信息生成
- 参数映射：工作流参数映射为Tool参数

**AI调用配置**:
- 启用/禁用AI调用
- 自定义工具名称
- AI描述（供LLM理解）
- 调用示例
- 参数说明
- 是否需要确认

---

#### 7.2 工具商店
**功能描述**: 浏览和管理所有可用工具

**工具分类**:
- Workflow工具
- MCP工具
- HTTP API工具
- 系统工具
- 自定义工具

**工具卡片信息**:
- 工具名称、图标
- 工具描述
- 工具类型
- 使用次数
- 成功率
- 是否启用

**工具操作**:
- 启用/禁用工具
- 查看工具详情
- 测试工具
- 配置工具权限
- 删除工具

---

#### 7.3 工具审批机制
**功能描述**: 对敏感工具调用进行审批

**审批流程**:
```
Agent请求调用工具
    ↓
系统检查是否需要审批
    ↓
如果需要 → 弹出审批对话框
    ↓
显示工具信息：
  - 工具名称
  - 调用参数
  - 调用原因
  - 潜在影响
    ↓
用户选择：批准 / 拒绝
    ↓
如果批准 → 执行工具 → 返回结果
如果拒绝 → 返回拒绝消息 → Agent重新思考
```

**审批规则配置**:
- 全局规则：所有敏感工具需审批
- 白名单：信任的工具自动批准
- 黑名单：禁止的工具直接拒绝
- 基于参数的规则：特定参数值触发审批

**审批历史**:
- 记录所有审批请求
- 批准/拒绝状态
- 审批时间
- 审批人
- 可追溯

---

### 8. AI助理"贾维斯"

#### 8.1 全局搜索框
**功能描述**: Spotlight风格的极简交互入口

**UI设计**:
- 半透明悬浮窗
- 居中显示
- 输入框 + 搜索结果列表
- 支持Markdown渲染

**唤出方式**:
- 全局快捷键（可自定义，默认Cmd/Ctrl + Space）
- 点击托盘图标
- 应用内快捷按钮

---

#### 8.2 自然语言理解与任务规划
**功能描述**: 理解用户意图并自动执行

**工作流程**:
```
用户输入任务描述
    ↓
AI理解意图
    ↓
任务规划（拆解为步骤）
    ↓
选择合适的工具/工作流
    ↓
生成执行计划
    ↓
显示计划并请求确认（关键操作）
    ↓
执行计划
    ↓
实时反馈进度
    ↓
返回最终结果
```

**示例场景**:
- 用户："帮我整理今天的邮件并生成摘要"
- AI规划：
  1. 调用邮件工作流读取邮件
  2. 使用AI Process节点生成摘要
  3. 保存摘要到文件
  4. 发送通知

---

#### 8.3 实时反馈与上下文管理
**功能描述**: 任务执行过程中的实时反馈

**实时反馈**:
- 当前执行步骤
- 进度百分比
- 中间结果展示
- 错误提示

**上下文管理**:
- 多轮对话理解上下文
- 任务上下文保持
- 跨会话记忆
- 引用历史对话

---

## 技术架构

### Agent系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    PC端Agent系统                         │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              Agent管理层 (React)                    │ │
│  │                                                     │ │
│  │  - Agent配置管理                                    │ │
│  │  - 会话管理                                         │ │
│  │  - 对话UI                                           │ │
│  │  - 工具管理                                         │ │
│  └────────────────────────────────────────────────────┘ │
│                         ↕ IPC / HTTP                     │
│  ┌────────────────────────────────────────────────────┐ │
│  │         Python Sidecar Agent引擎                    │ │
│  │                                                     │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │           AgentScope框架                      │  │ │
│  │  │                                               │  │ │
│  │  │  ┌────────────┐  ┌────────────┐  ┌────────┐ │  │ │
│  │  │  │Basic Agent │  │ReAct Agent │  │Research│ │  │ │
│  │  │  └────────────┘  └────────────┘  └────────┘ │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  │                                                     │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │           工具调用层                          │  │ │
│  │  │                                               │  │ │
│  │  │  - Workflow Tool Executor                     │  │ │
│  │  │  - MCP Tool Client                            │  │ │
│  │  │  - HTTP API Client                            │  │ │
│  │  │  - System Tool Executor                       │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  │                                                     │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │           LLM服务层                           │  │ │
│  │  │                                               │  │ │
│  │  │  - OpenAI Client                              │  │ │
│  │  │  - Claude Client                              │  │ │
│  │  │  - Coze Client                                │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  │                                                     │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │           知识库服务层                        │  │ │
│  │  │                                               │  │ │
│  │  │  - Embedding Client                           │  │ │
│  │  │  - Vector DB (本地 Chroma/FAISS)             │  │ │
│  │  │  - 检索引擎                                   │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                         ↕ HTTPS
┌─────────────────────────────────────────────────────────┐
│                    云端服务                              │
│                                                          │
│  - Agent配置存储                                         │
│  - 会话历史存储                                          │
│  - 知识库文件存储                                        │
│  - LLM服务代理                                           │
└─────────────────────────────────────────────────────────┘
```

---

### 核心技术栈

**前端**:
- Agent UI: React 18 + TypeScript
- 状态管理: Zustand
- 对话UI: 自定义Markdown渲染器
- 代码高亮: highlight.js
- 数学公式: KaTeX

**Python Sidecar Agent引擎**:
- **AgentScope**: Multi-Agent框架
- **LangChain**: Agent工具集成（可选，用于工具编排）
- **LLM集成**:
  - openai: OpenAI API客户端
  - anthropic: Claude API客户端
  - 自定义Coze客户端
- **向量数据库**:
  - chromadb: 本地向量数据库
  - 或 faiss: Facebook AI相似性搜索
- **文档处理**:
  - pypdf2: PDF解析
  - python-docx: DOCX解析
  - openpyxl: XLSX解析
  - beautifulsoup4: HTML解析
- **Embedding**:
  - sentence-transformers: 本地Embedding模型（可选）
  - OpenAI Embedding API

---

### 数据模型

#### Agent配置
```json
{
  "id": "uuid",
  "name": "Agent名称",
  "type": "basic|react|deep_research",
  "description": "描述",
  "avatar": "头像URL",
  "tags": ["tag1", "tag2"],
  "model_config": {
    "provider": "openai|claude|coze",
    "model": "gpt-4-turbo",
    "temperature": 0.7,
    "max_tokens": 2000,
    "top_p": 1.0
  },
  "prompt_config": {
    "system_prompt": "系统提示词",
    "variables": {}
  },
  "memory_config": {
    "short_term": {
      "enabled": true,
      "window_size": 10
    },
    "long_term": {
      "enabled": true
    }
  },
  "knowledge_base_ids": ["kb_id1", "kb_id2"],
  "tool_ids": ["tool_id1", "tool_id2"],
  "permissions": {
    "auto_approve_tools": ["tool_id1"],
    "require_approval_tools": ["tool_id2"]
  }
}
```

#### 会话
```json
{
  "id": "uuid",
  "agent_id": "uuid",
  "title": "会话标题",
  "messages": [
    {
      "id": "msg_uuid",
      "role": "user|assistant|system",
      "content": "消息内容",
      "attachments": [],
      "timestamp": "2025-11-08T10:00:00Z"
    }
  ],
  "created_at": "2025-11-08T10:00:00Z",
  "updated_at": "2025-11-08T10:05:00Z"
}
```

#### 知识库
```json
{
  "id": "uuid",
  "name": "知识库名称",
  "description": "描述",
  "embedding_model": "text-embedding-ada-002",
  "chunk_config": {
    "chunk_size": 1000,
    "chunk_overlap": 200,
    "separators": ["\n\n", "\n", " "]
  },
  "documents": [
    {
      "id": "doc_uuid",
      "name": "文档名称",
      "type": "pdf|docx|txt",
      "size": 1024000,
      "status": "pending|processing|completed|failed",
      "chunks_count": 50,
      "uploaded_at": "2025-11-08T10:00:00Z"
    }
  ],
  "stats": {
    "total_documents": 10,
    "total_chunks": 500,
    "total_vectors": 500,
    "storage_size_mb": 50
  }
}
```

---

## 开发计划

### 时间线（共2.5个月）

#### 第1个月：Agent核心与知识库

**Week 1-2: Agent基础框架**
- [ ] Agent管理UI框架搭建
- [ ] Agent列表、创建、编辑页面
- [ ] Agent配置保存与加载
- [ ] Python Sidecar集成AgentScope
- [ ] Basic Agent实现
- [ ] 对话UI实现（支持Markdown、流式输出）
- [ ] 会话管理实现

**Week 3-4: 知识库系统**
- [ ] 知识库管理UI
- [ ] 文档上传功能
- [ ] 文档解析（PDF、DOCX等）
- [ ] 文本分块算法
- [ ] 向量化集成（OpenAI Embedding）
- [ ] 向量数据库集成（Chroma）
- [ ] 向量检索实现
- [ ] 检索测试工具

---

#### 第2个月：ReAct Agent与工具集成

**Week 5-6: ReAct Agent**
- [ ] ReAct Agent Prompt设计
- [ ] Thought-Action-Observation循环实现
- [ ] 工具调用解析
- [ ] Workflow工具注册
- [ ] MCP工具客户端
- [ ] HTTP API工具
- [ ] 工具调用执行
- [ ] 工具审批对话框

**Week 7-8: 工具商店与记忆系统**
- [ ] 工具商店UI
- [ ] 工具浏览、搜索、筛选
- [ ] 工具权限配置
- [ ] 工具调用历史
- [ ] 短期记忆实现
- [ ] 长期记忆实现
- [ ] 工作记忆实现
- [ ] 记忆管理UI

---

#### 第3个月（前2周）：Deep Research Agent与贾维斯

**Week 9: Deep Research Agent**
- [ ] 任务拆解算法
- [ ] 多源信息检索
- [ ] 并行任务执行
- [ ] 结果汇总
- [ ] 报告生成（Markdown格式）
- [ ] 研究配置UI

**Week 10: AI助理"贾维斯"与完善**
- [ ] 全局搜索框UI（Spotlight风格）
- [ ] 快捷键唤出
- [ ] 自然语言理解与任务规划
- [ ] 工作流自动调用
- [ ] 实时反馈UI
- [ ] Agent模板库
- [ ] Agent监控面板
- [ ] Agent调试工具
- [ ] Agent评估系统
- [ ] 性能优化
- [ ] Bug修复与测试

---

### 开发任务分配建议

**前端团队（2人）**:
- 工程师A: Agent管理UI、对话UI、工具商店UI
- 工程师B: 知识库管理UI、AI助理"贾维斯"UI、Agent监控面板

**Python后端团队（2人）**:
- 工程师C: Agent引擎（Basic、ReAct）、LLM集成
- 工程师D: 知识库系统、向量检索、Deep Research Agent

**AI工程师（1人）**:
- AgentScope框架集成与优化
- Prompt工程
- 检索策略优化
- Agent评估体系

---

### 开发里程碑

**Milestone 1（第1个月末）**: Basic Agent与知识库完成
- ✅ Basic Agent可用
- ✅ 对话功能完整
- ✅ 知识库系统可用
- ✅ 向量检索正常工作

**Milestone 2（第2个月末）**: ReAct Agent与工具集成完成
- ✅ ReAct Agent可用
- ✅ 工具调用正常
- ✅ 工具审批机制完善
- ✅ 记忆系统可用

**Milestone 3（第2.5个月末）**: Phase 2完成
- ✅ Deep Research Agent可用
- ✅ AI助理"贾维斯"可用
- ✅ 所有功能通过验收
- ✅ 性能和稳定性达标

---

## 验收标准

### 功能性验收

#### 1. Basic Agent
- [ ] 可以创建Basic Agent
- [ ] 可以进行多轮对话
- [ ] 支持流式输出
- [ ] System Prompt配置生效
- [ ] 模型切换正常工作
- [ ] 会话管理功能完整

#### 2. ReAct Agent
- [ ] 可以创建ReAct Agent
- [ ] Thought-Action-Observation循环正常
- [ ] 可以调用Workflow工具
- [ ] 可以调用MCP工具
- [ ] 工具审批机制正常工作
- [ ] 多步推理达到预期效果

#### 3. Deep Research Agent
- [ ] 可以创建Deep Research Agent
- [ ] 任务自动拆解正常
- [ ] 多源信息检索正常
- [ ] 报告生成格式正确
- [ ] 引用溯源完整

#### 4. 知识库
- [ ] 可以创建知识库
- [ ] 文档上传成功率 > 95%
- [ ] 支持所有列出的文档格式
- [ ] 向量化成功率 > 95%
- [ ] 检索准确率 > 80%
- [ ] 检索响应时间 < 1秒

#### 5. 工具调用
- [ ] Workflow工具注册成功
- [ ] Agent可以正确调用工具
- [ ] 工具审批流程完整
- [ ] 工具调用成功率 > 90%
- [ ] 工具调用历史可追溯

#### 6. 记忆系统
- [ ] 短期记忆正常工作
- [ ] 长期记忆跨会话保持
- [ ] 工作记忆正常工作
- [ ] 记忆管理UI完整

#### 7. AI助理"贾维斯"
- [ ] 快捷键唤出正常
- [ ] 自然语言理解准确
- [ ] 任务规划合理
- [ ] 工作流自动调用成功
- [ ] 实时反馈清晰

---

### 性能验收

#### 1. 对话响应
- [ ] Basic Agent首次响应 < 2秒
- [ ] 流式输出延迟 < 500ms
- [ ] ReAct Agent单次迭代 < 5秒

#### 2. 知识库检索
- [ ] 向量检索 < 1秒（1000个文档）
- [ ] 混合检索 < 2秒
- [ ] 文档向量化速度 > 100页/分钟

#### 3. 工具调用
- [ ] Workflow工具调用响应 < 100ms
- [ ] 整个工具调用链路 < 10秒（含执行）

---

### 质量验收

#### 1. Agent质量
- [ ] Basic Agent回答准确性 > 85%
- [ ] ReAct Agent任务完成率 > 80%
- [ ] Deep Research Agent报告质量 > 85%（人工评估）

#### 2. 检索质量
- [ ] Top-5检索准确率 > 80%
- [ ] 召回率 > 90%

#### 3. 稳定性
- [ ] Agent连续对话100轮不崩溃
- [ ] 知识库处理100个文档不出错
- [ ] 工具调用失败有重试机制

---

## 风险与应对

### 技术风险

#### 风险1: AgentScope学习曲线陡峭
**影响**: 开发进度延迟
**应对措施**:
- Week 1提前学习AgentScope文档
- 参考官方示例项目
- 必要时考虑使用LangChain替代

#### 风险2: 向量数据库性能不足
**影响**: 检索速度慢，影响用户体验
**应对措施**:
- 使用Chroma或FAISS等高性能向量库
- 实现索引优化
- 分批向量化减少内存占用
- 必要时使用云端向量库（如Pinecone）

#### 风险3: LLM API调用不稳定
**影响**: Agent响应失败，用户体验差
**应对措施**:
- 实现重试机制
- 支持多模型降级
- 本地缓存常见问答
- 显示友好的错误提示

---

### 进度风险

#### 风险1: 知识库系统开发复杂度高
**影响**: 第1个月进度延迟
**应对措施**:
- 使用成熟的向量库（Chroma）
- 文档解析使用现成库
- 分块策略使用LangChain的TextSplitter
- 并行开发UI和后端

#### 风险2: ReAct Agent调试困难
**影响**: 第2个月进度延迟
**应对措施**:
- 从简单工具开始调试
- 实现完善的日志系统
- 使用LangSmith等调试工具（可选）
- 参考成熟的ReAct实现

---

## 交付物清单

### 代码交付物
- [ ] Agent系统前端代码
- [ ] Agent引擎Python代码
- [ ] 知识库系统代码
- [ ] 工具调用系统代码
- [ ] 单元测试代码

### 文档交付物
- [ ] Agent使用手册
- [ ] 知识库使用指南
- [ ] 工具开发指南
- [ ] Prompt最佳实践
- [ ] API文档

### 应用交付物
- [ ] 集成Agent功能的PC端应用
- [ ] Agent模板库（至少5个模板）
- [ ] 示例知识库

---

## 后续计划

Phase 2完成后，进入Phase 3: 语音通话。

**Phase 3的依赖**:
- ✅ Agent系统可以接收和响应消息
- ✅ 工具调用机制完善
- ✅ 对话管理完整

**Phase 2需要预留的扩展点**:
- [ ] Agent支持语音输入输出接口
- [ ] 对话历史支持语音消息
- [ ] 工具调用支持通话相关操作

---

## 附录

### 附录A: AgentScope资源链接

**官方文档**:
- AgentScope GitHub: https://github.com/modelscope/agentscope
- 快速入门: https://modelscope.github.io/agentscope/
- API文档: https://modelscope.github.io/agentscope/en/api/index.html

**示例项目**:
- Multi-Agent会话示例
- ReAct Agent示例
- RAG Agent示例

---

### 附录B: Prompt工程最佳实践

**Basic Agent Prompt**:
```
你是一个专业的AI助手，名叫{agent_name}。

你的职责是：
- 回答用户的问题
- 提供准确、有用的信息
- 保持友好、专业的态度

限制条件：
- 如果你不确定答案，请诚实地告诉用户
- 不要编造信息
- 保护用户隐私

当前时间: {current_time}
用户名: {username}
```

**ReAct Agent Prompt**:
```
你是一个可以使用工具的AI助手。你可以通过以下格式进行推理和行动：

Thought: 你对当前情况的分析和思考
Action: tool_name[参数]
Observation: 工具返回的结果

可用工具：
{tools_description}

请按照以下格式回答用户问题。当你得到最终答案时，使用：
Final Answer: 你的最终答案
```

---

### 附录C: 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| V1.0 | 2025-11-08 | 初始版本 | 产品团队 |

---

**文档状态**: ✅ 完成  
**最后更新**: 2025-11-08

**下一步**: 查看 [Phase 2: 三种Agent - 后台服务迭代计划](./backend-service.md)