# 助手-贾维斯 (Assistant-Jarvis) - 产品需求文档 (PRD)

**版本**: V2.2  
**日期**: 2025-11-08  
**文档状态**: 正式版  
**适用范围**: PC端、移动端、管理后台

---

## 目录

1. [产品概述](#1-产品概述)
2. [目标用户](#2-目标用户)
3. [产品架构](#3-产品架构)
4. [PC端功能需求](#4-pc端功能需求)
5. [移动端功能需求](#5-移动端功能需求)
6. [管理后台功能需求](#6-管理后台功能需求)
7. [技术架构概览](#7-技术架构概览)
8. [非功能性需求](#8-非功能性需求)
9. [产品路线图](#9-产品路线图)
10. [成功指标](#10-成功指标)

---

## 1. 产品概述

### 1.1 产品愿景

"助手-贾维斯"是一款旨在重新定义个人生产力的跨平台智能助理。它以强大的机器人流程自动化（RPA）为执行基础，以先进的多智能体（Multi-Agent）系统为决策核心，致力于将用户从重复、繁琐的数字化工作中解放出来，并能主动、智能地处理实时通信任务（包括语音通话和视频通话），最终成为用户在数字世界中不可或缺的AI伙伴。

**核心设计哲学：驾驶舱与引擎分离**

本产品采用"驾驶舱与引擎分离"的架构设计：
- **驾驶舱（Frontend UI）**：使用现代Web技术（Tauri 2 + React）构建的轻量、高性能图形界面，负责用户交互、工作流可视化编排和任务状态呈现，但不执行任何底层自动化逻辑
- **引擎（Backend Core）**：独立的Python Sidecar后台进程，集成AI决策、GUI/Web自动化、系统级集成等所有核心能力，是所有任务的实际执行者

这种架构确保了前端的流畅性和跨平台一致性，同时将后端复杂的、平台相关的逻辑完全解耦，极大提升了系统的稳定性、安全性和未来的可扩展性。

### 1.2 核心价值

- **极致自动化**: 通过智能录制器和可视化工作流设计器，让任何人都能轻松创建复杂的自动化流程
- **AI驱动**: 基于先进的Multi-Agent系统，支持自然语言交互，智能理解和执行任务
- **跨平台协同**: PC端执行、移动端监控、云端管理，无缝协同工作
- **开放生态**: 支持模板市场、工具商店，构建开放的自动化生态系统

### 1.3 产品定位

- **C端用户**: 个人效率工具，帮助用户自动化日常重复工作
- **B端客户**: 企业级自动化平台，提供工作流协同、团队管理、数据安全等能力
- **开发者**: 开放的Agent和工作流平台，支持自定义扩展和二次开发

---

## 2. 目标用户

### 2.1 用户画像

**高效能办公族（张伟）**
- **年龄**: 30岁
- **职业**: 市场经理
- **痛点**: 每天处理大量报表、整理客户资料、发送周报邮件，重复工作占据大量时间
- **需求**: 将固定流程自动化，节省时间用于更有创造性的策略思考
- **关注功能**: 工作流录制、数据提取、报表自动生成、邮件自动发送

**技术爱好者（李静）**
- **年龄**: 25岁
- **职业**: 程序员
- **痛点**: 需要频繁在多个系统之间切换操作，希望有更强大的自动化能力
- **需求**: 足够强大、开放的自动化平台，可以定制复杂的个性化工作流
- **关注功能**: 高级工作流编排、API集成、自定义脚本、Agent开发

**小微企业主（王老板）**
- **年龄**: 40岁
- **职业**: 电商创业者
- **痛点**: 人手有限，需要亲自处理订单、回复客户咨询，无法休息
- **需求**: 7×24小时的"数字员工"，能在休息时处理客服和订单任务
- **关注功能**: AI通话接听、智能客服、订单处理自动化、移动端监控

**企业IT管理员（刘工）**
- **年龄**: 35岁
- **职业**: IT部门负责人
- **痛点**: 需要为公司部署统一的自动化解决方案，管理员工的使用权限和数据安全
- **需求**: 企业级管理后台，支持用户管理、权限控制、数据审计
- **关注功能**: 用户管理、权限系统、审计日志、模板统一管理

---

## 3. 产品架构

### 3.1 三端架构

```
┌─────────────────────────────────────────────────────────────────┐
│                          云端服务层                              │
│                       (Go + Supabase)                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  用户管理    │  │  模板市场    │  │  数据存储    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  支付系统    │  │  模型服务    │  │  监控统计    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
            ↕ WebSocket/HTTPS              ↕ WebSocket/HTTPS
            (实时状态同步)                   (远程控制指令)
┌──────────────────────────────┐  ┌──────────────────────────────┐
│        PC客户端               │  │    移动端 (iOS/Android)       │
│     (Tauri 2 + React)         │  │      (React Native)          │
│  ┌────────────────────────┐  │  │  ┌────────────────────────┐  │
│  │   工作流设计器         │  │  │  │     实时监控           │  │
│  │   Agent中心            │  │  │  │     远程控制           │  │
│  │   自动化执行           │  │  │  │     通知中心           │  │
│  │   智能录制             │  │  │  │     任务管理           │  │
│  │   AI通话               │  │  │  │     通话记录           │  │
│  │   知识库               │  │  │  │     统计报表           │  │
│  └────────────────────────┘  │  │  └────────────────────────┘  │
└──────────────────────────────┘  └──────────────────────────────┘

说明：
- PC端和移动端都通过云端进行通信，不直接连接
- PC端通过WebSocket实时上报任务状态、执行日志到云端
- 移动端通过WebSocket订阅云端状态更新，实现实时监控
- 移动端发送远程控制指令到云端，云端转发给对应的PC端
- 支持跨网络环境（PC和手机不在同一局域网）的远程管理
```

### 3.2 数据流向

**PC端 ↔ 云端**：
- **上行**：工作流定义、执行日志、任务状态、通话记录、使用统计
- **下行**：模板下载、模型服务调用、远程控制指令（来自移动端）、配置同步

**移动端 ↔ 云端**：
- **上行**：远程控制指令（启动/停止任务）、设置修改、查询请求
- **下行**：实时状态推送（PC端状态）、任务通知、执行日志、统计数据

**移动端 ↔ PC端（通过云端中转）**：
- 移动端发送控制指令 → 云端 → PC端执行
- PC端上报状态 → 云端 → 移动端实时显示
- 支持跨网络环境，无需PC和手机在同一局域网

---

## 4. PC端功能需求

### 4.1 账号与安全

#### 4.1.1 用户认证
- **账号密码登录**: 支持邮箱/用户名 + 密码登录
- **第三方登录**: 微信扫码、Google账号（海外版）
- **Token管理**: JWT Token自动刷新，支持多设备登录
- **会话管理**: 保持登录状态，异地登录提醒

#### 4.1.2 应用绑定
- **第三方应用集成**: 支持与桌面应用集成（企业微信、钉钉、Slack等）
- **应用检测**: 
  - macOS：通过Bundle ID和应用路径检测
  - Windows：通过进程名和注册表信息检测
- **应用连接配置**: 支持API Token、Webhook等连接方式
- **身份验证**: 验证应用连接的有效性和安全性

#### 4.1.3 数据安全
- **本地加密存储**: 敏感配置AES-256加密
- **密钥管理**: 系统凭据存储（Keychain/Credential Manager）
- **数据传输加密**: WebSocket/HTTPS加密传输
- **操作审计日志**: 记录所有关键操作，支持导出

#### 4.1.4 权限系统
- **角色权限**: 用户角色与权限管理
- **功能权限**: 细粒度功能访问控制
- **工具审批**: 敏感工具调用需人工审批
- **数据权限**: 数据访问范围控制

---

### 4.2 工作流设计中心 (Studio)

#### 4.2.1 可视化画布
- **无限画布**: 支持拖拽、缩放、平移的无限大画布
- **网格背景**: 可选的网格对齐功能
- **小地图导航**: 在复杂工作流中快速定位
- **画布操作**: 
  - 撤销/重做（Undo/Redo）
  - 复制/粘贴节点
  - 批量选择和移动
  - 节点对齐和分布
  - 框选多个节点

#### 4.2.2 节点库（23种节点类型）

**UI自动化节点（7种）**
1. **Click（点击）**: 单击、双击、右键，支持修饰键和偏移量
2. **Input（输入）**: 文本输入，支持清空、输入速度控制、回车确认
3. **Drag & Drop（拖拽）**: 元素拖拽，支持元素到元素、元素到位置
4. **Scroll（滚动）**: 上下左右滚动，支持滚动到指定元素
5. **Hover（悬停）**: 鼠标悬停，支持悬停时长和偏移量
6. **Keyboard（键盘）**: 键盘按键，支持修饰键和组合键
7. **Delay（延迟）**: 固定时长延迟等待

**流程控制节点（3种）**
8. **Variable（变量操作）**: 设置、获取、递增、追加、清除变量
9. **Compare（比较）**: 条件比较，支持多种运算符（==、!=、>、<、contains等）
10. **Data Extract（数据提取）**: 从元素、页面、剪贴板提取数据，支持正则、表格、列表提取

**集成节点（3种）**
11. **HTTP Request（HTTP请求）**: GET、POST等请求，支持Headers、Body、Query参数
12. **MCP Tool（MCP工具调用）**: 调用MCP协议工具
13. **Subworkflow（子工作流）**: 调用其他工作流，支持参数映射

**文件操作节点（2种）**
14. **File Selector（文件选择器）**: 打开文件选择对话框，支持单选、多选、文件夹
15. **File Operation（文件操作）**: 读写、复制、移动、删除文件

**系统操作节点（3种）**
16. **Clipboard（剪贴板）**: 读写剪贴板，支持文本、图片、HTML
17. **Shell Command（Shell命令）**: 执行系统命令，支持工作目录、环境变量
18. **App Control（应用控制）**: 启动、退出、激活、隐藏应用

**时间操作节点（1种）**
19. **DateTime（日期时间）**: 获取、格式化、计算日期时间

**AI操作节点（2种）**
20. **AI Process（AI处理）**: 文本生成、分类、情感分析、提取、翻译、OCR
21. **AI Call（AI通话）**: 启动/停止AI通话，配置ASR、TTS、对话参数

**通知节点（1种）**
22. **Notification（通知发送）**: 发送系统通知、企业微信、钉钉、Slack通知

**Agent调用节点（1种）**
23. **Agent Call（调用Agent）**: 调用Agent执行任务，支持会话管理、知识库绑定

#### 4.2.3 节点配置面板
- **基本属性**: 节点名称、描述、图标、颜色
- **元素定位**: 配置目标元素定位策略（AXUI、OCR、Image、Position）
- **操作参数**: 详细的操作参数配置
- **错误处理**: 失败时的处理策略（停止/继续/重试/跳转）
- **条件执行**: 基于变量的条件判断
- **截图配置**: 执行前后截图用于调试

#### 4.2.4 元素定位策略
- **AXUI定位**: 
  - macOS：基于Accessibility API（Role、Title、Identifier）
  - Windows：基于UI Automation（ControlType、Name、AutomationId）
- **OCR定位**: 基于OCR文字识别，支持模糊匹配
- **Image定位**: 基于图像模板匹配
- **Position定位**: 基于屏幕坐标（兜底方案）
- **策略优先级**: 支持配置多个定位策略，按优先级依次尝试
- **超时和重试**: 可配置超时时间和重试次数

#### 4.2.5 工作流属性
- **基本信息**: 名称、描述、分类、标签、图标
- **版本管理**: 版本号、更新日志、版本对比
- **系统要求**: 操作系统、目标应用、权限要求
- **参数定义**: 输入参数配置（类型、默认值、是否必填）
- **触发器配置**: 定时触发、通知触发、Webhook触发
- **AI配置**: 是否允许AI调用、工具描述、调用示例

#### 4.2.6 工作流管理
- **工作流列表**: 
  - 分类筛选、标签筛选、状态筛选
  - 搜索工作流名称和描述
  - 按更新时间、执行次数、成功率排序
- **工作流操作**: 
  - 新建、编辑、复制、删除
  - 导出/导入（JSON格式）
  - 发布/取消发布、归档
- **兼容性检查**: 
  - 自动检测操作系统兼容性
  - 检测目标应用是否安装
  - 验证所需权限是否授予
  - 显示兼容性状态和解决建议
- **快速适配**: 
  - 适配向导引导重新录制不兼容节点
  - 元素重定位更新定位器
  - 适配不同版本应用

---

### 4.3 智能录制器

#### 4.3.1 录制功能
- **一键启动**: 全局悬浮窗或快捷键启动/停止录制
- **暂停/恢复**: 支持录制过程中暂停和恢复
- **操作捕获**: 自动捕获点击、输入、拖拽、滚动等操作
- **元素捕获**: 记录操作的目标元素及其定位信息
- **生成工作流**: 将录制的操作自动转换为工作流节点

#### 4.3.2 实时元素高亮
- **Overlay Window**: 透明覆盖层窗口用于元素高亮
- **Hover高亮**: 鼠标悬停时高亮元素边框（黄色）
- **Selected状态**: 选中元素时显示蓝色边框
- **Confirmed状态**: 确认元素时显示绿色边框
- **多选支持**: 支持选择多个元素批量操作
- **自定义样式**: 可自定义高亮边框颜色、宽度、样式

**技术实现细节**：

1. **叠加窗口（Overlay Window）创建**：
   - 用户点击"录制"后，Tauri创建一个无边框、全屏、透明、置顶的叠加窗口
   - 窗口属性：`decorations: false`、`transparent: true`、`always_on_top: true`、`fullscreen: true`
   - 通过`set_ignore_cursor_events(true)` API设置为**鼠标事件可穿透**，不影响用户正常操作底层应用

2. **实时元素识别与高亮流程**：
   ```
   用户移动鼠标
        ↓
   Python引擎的pynput线程捕获鼠标坐标
        ↓
   调用pywinauto/pyobjc获取指针下方的UI元素
        ↓
   提取元素的屏幕矩形坐标（x, y, width, height）
        ↓
   通过Tauri事件系统发送到前端叠加窗口
        ↓
   叠加窗口中的JavaScript实时更新div元素的CSS样式
        ↓
   在目标元素上"画"出高亮边框
   ```

3. **元素选择确认**：
   - 用户点击鼠标或按下特定快捷键（如Enter）确认选择
   - Python引擎记录该元素的选择器信息：
     - macOS：Role、Title、Identifier、AXPath
     - Windows：ControlType、Name、AutomationId、Path
   - 生成稳定的元素定位器，完成一步录制

4. **性能优化**：
   - 元素识别采用节流机制（throttle），避免过度频繁的API调用
   - 高亮边框更新使用requestAnimationFrame，确保流畅动画
   - 缓存已识别的元素信息，减少重复查询

#### 4.3.3 智能选择器
- **稳定定位**: 保存元素的内在属性（文本、ID、角色）而非屏幕坐标
- **自适应**: 窗口大小、位置、分辨率变化时依然能准确找到元素
- **多策略组合**: 自动生成多个备选定位策略，提高成功率
- **定位器优化**: 按可靠性排序定位策略，优先使用最可靠的方式

#### 4.3.4 浏览器情境感知
- **Web录制模式**: 检测到浏览器操作时自动切换到Web录制
- **登录状态保持**: 支持持久化浏览器上下文，保持登录状态
- **跨域支持**: 支持跨域名的Web自动化流程
- **浏览器兼容**: 支持Chrome、Edge、Firefox、Safari

#### 4.3.5 录制模式
- **全自动录制**: 自动捕获所有操作，无需手动确认
- **手动录制**: 手动点击确认每个操作，精确控制
- **智能识别**: 自动识别操作类型（点击、输入、拖拽等）

---

### 4.4 Agent中心

#### 4.4.1 Agent类型

**Basic Agent（基础Agent）**
- **核心能力**: 直接调用LLM生成回复，支持多轮对话
- **适用场景**: 简单对话、客服问答、文本生成
- **配置项**: 
  - 模型选择（OpenAI、Claude、Coze、本地模型）
  - Temperature、Max Tokens、Top-P等参数
  - System Prompt自定义
  - 回复风格设定

**ReAct Agent（推理行动Agent）**
- **核心能力**: Thought-Action-Observation循环，支持工具调用和多步推理
- **适用场景**: 需要多步推理、需要调用工具的复杂任务
- **配置项**: 
  - 最大迭代次数
  - 工具选择策略
  - 思考链可见性
  - 超时控制

**Deep Research Agent（深度研究Agent）**
- **核心能力**: 自动拆解研究任务、多源信息检索、生成结构化报告
- **适用场景**: 复杂研究任务、信息整合、深度分析
- **配置项**: 
  - 研究深度级别
  - 信息源范围
  - 可信度阈值
  - 报告格式模板

#### 4.4.2 对话能力
- **会话管理**: 创建、列表、切换、删除、导出会话
- **记忆系统**: 
  - **短期记忆**: 当前对话上下文，滑动窗口机制
  - **长期记忆**: 跨会话知识保留，用户偏好记忆
  - **工作记忆**: 任务执行状态，临时变量存储
- **对话策略**: 
  - 支持用户打断Agent回复
  - 多模态输入（文本、图片、文件）
  - 流式输出实时返回
  - 引用溯源显示来源

#### 4.4.3 知识库集成
- **知识库类型**: 文档、网页、结构化数据、API数据源
- **检索策略**: 
  - 向量检索（语义相似度）
  - 关键词检索（全文搜索）
  - 混合检索（向量+关键词）
  - Rerank重排序
- **知识库管理**: 
  - 文档上传（拖拽、批量上传）
  - 支持格式：PDF、DOCX、XLSX、TXT、MD、HTML、PPT
  - 分块策略配置
  - 自动向量化处理
  - 检索效果测试
  - 统计分析

#### 4.4.4 工具调用能力
- **工具类型**: 
  - Workflow工具（调用工作流）
  - MCP工具（Model Context Protocol）
  - HTTP API工具
  - 系统工具（文件操作、Shell命令）
  - 内置工具（计算器、日期处理）
- **调用流程**: 
  - 自动调用：Agent自动决策
  - 审批调用：需人工审批
  - 手动调用：用户手动触发
- **工具审批机制**: 
  - 配置审批规则
  - 申请→审批→执行流程
  - 自动审批条件
  - 审批历史可追溯

#### 4.4.5 Agent管理
- **Agent配置**: 
  - 基本信息（名称、描述、头像、标签）
  - 模型配置
  - Prompt配置
  - 记忆配置
  - 知识库绑定
  - 工具绑定
  - 权限配置
- **Agent模板库**: 
  - 客服类、分析类、创作类、研究类、协作类模板
  - 从模板快速创建Agent
  - 支持模板自定义和保存
- **Agent监控面板**: 
  - 实时状态显示
  - 执行日志查看
  - 性能指标（响应时间、成功率、Token消耗）
  - 告警配置
- **Agent调试工具**: 
  - 逐步执行调试
  - 变量实时查看
  - Prompt调试测试
  - 工具调用链路追踪
  - 详细执行日志
  - 性能瓶颈分析
- **Agent评估系统**: 
  - 输出质量评估
  - 执行效率评估
  - 用户满意度统计
  - 自动评估打分
  - 生成评估报告

---

### 4.5 Multi-Agent协同

#### 4.5.1 协同模式一：工作流编排
- **顺序执行**: Agent按顺序协作完成任务
- **并行执行**: 多个Agent同时工作
- **条件分支**: 根据结果选择不同Agent
- **循环执行**: 重复调用直到满足条件
- **数据传递**: Agent之间传递数据
- **可视化编排**: 拖拽式工作流设计器
- **数据映射**: 配置输入输出映射关系
- **错误处理**: Agent失败的恢复机制

#### 4.5.2 协同模式二：组织架构
- **组织角色**: 
  - Director（总监）：最高决策层，分配任务给Manager
  - Manager（经理）：中层管理，分配任务给Employee
  - Employee（员工）：执行具体任务
- **任务分配流程**: 
  - 任务下发：上级向下级分配
  - 任务分解：Manager拆解为子任务
  - 任务执行：Employee执行
  - 结果上报：下级向上级汇报
  - 任务审核：上级审核完成情况
- **组织管理**: 
  - 创建组织结构
  - 配置层级和角色
  - 分配Agent到角色
  - 权限设置
  - 可视化组织架构图

#### 4.5.3 协同模式三：Supervisor + Sub Agent
- **Supervisor能力**: 
  - 任务分解：拆解为子任务
  - 智能分配：根据Sub Agent能力分配
  - 执行监控：实时监控执行状态
  - 质量审查：审查输出质量
  - 结果综合：汇总所有结果
- **Sub Agent角色**: 
  - 任务接收
  - 独立执行
  - 结果上报
  - 协同通信（可选）
- **工作流程**: 
  - 任务输入→分解→分配→并行执行→质量审查→结果综合→最终输出

#### 4.5.4 协同模式四：Multi-Agent会议
- **会议角色**: 
  - Moderator（主持人）：主持流程、分配发言权
  - Participants（参与者）：参与讨论的Agent
  - Observers（观察者）：只观察不发言
- **会议类型**: 
  - 自由讨论
  - 决策会议
  - 头脑风暴
  - 问题诊断
- **会议配置**: 
  - 会议主题
  - 参与Agent及角色
  - 最大轮次
  - 发言规则（轮流、举手、自由）
  - 终止条件
- **会议UI**: 
  - 实时会议界面（流式显示发言）
  - 会议历史页面
  - 会议纪要（决策、行动项、风险）

#### 4.5.5 Multi-Agent可视化
- **协同拓扑图**: 
  - 节点类型：Agent、Workflow、Tool、Knowledge Base
  - 连接类型：数据流、调用关系、引用关系
  - 实时更新：高亮当前执行节点
  - 布局算法：层次布局、力导向布局
- **消息流可视化**: 
  - 消息时间线
  - Agent泳道视图
  - 消息卡片（内容、类型、时间戳）
  - 实时模式显示新消息

---

### 4.6 AI助理"贾维斯"

#### 4.6.1 极简交互入口
- **全局搜索框**: 类似Spotlight的极简界面
- **快捷键唤出**: 可自定义全局快捷键
- **自然语言输入**: 直接输入任务描述
- **多模态输入**: 支持文本、语音、图片输入

#### 4.6.2 意图理解与执行
- **自然语言理解**: 理解用户意图并转换为执行计划
- **任务规划**: 将复杂任务拆解为步骤
- **工作流调用**: 自动调用或创建工作流执行任务
- **实时反馈**: 显示执行进度和中间结果
- **执行确认**: 关键操作前请求用户确认

#### 4.6.3 上下文管理
- **多轮对话**: 支持连续对话，理解上下文
- **任务上下文**: 保持当前任务的上下文信息
- **跨会话记忆**: 记住用户偏好和历史任务

---

### 4.7 自动化通信助理

#### 4.7.1 AI智能接听

**来电检测**
- **通知监听**: 监听系统和应用的来电通知
- **来电人识别**: 提取来电人信息
- **自动接听**: 检测到来电后自动接听（可配置规则）
- **接听规则**: 
  - "开会时自动接听"
  - "陌生号码由AI接听"
  - "特定联系人自动接听"
  - 时间段规则（工作时间、休息时间）

**阿里云智能媒体服务集成**
- **ASR（语音识别）**: 
  - 实时语音识别
  - 支持中文、英文等多语言
  - 自动标点
  - 采样率：16000Hz
- **TTS（语音合成）**: 
  - 实时语音合成
  - 多种发音人选择
  - 语速、音量可调
- **对话管理**: 
  - 支持打断（Interruption）
  - 静音检测
  - 自动挂断（静音超时）
  - 最大通话时长限制

**虚拟音频**
- **虚拟输入设备**: 将AI声音输入到通话应用
- **虚拟输出设备**: 捕获通话应用的声音输出
- **音频设备切换**: 自动切换系统默认音频设备
- **音频设备恢复**: 通话结束后恢复原设备
- **驱动安装**: 
  - Windows：VB-CABLE
  - macOS：BlackHole

**音频接管技术实现细节**：

这是整个AI通话功能的核心技术难点，通过虚拟音频设备实现音频流的完全接管和重定向。

1. **虚拟音频驱动安装**：
   - **Windows**：应用安装包中捆绑`VB-CABLE`安装程序
   - **macOS**：应用安装包中捆绑`BlackHole`安装程序
   - 首次设置AI通话功能时，引导用户完成一次性的驱动安装授权
   - 安装后系统会出现新的虚拟音频设备：
     - VB-CABLE Input（虚拟麦克风）
     - VB-CABLE Output（虚拟扬声器）

2. **来电监听与触发**：
   - Python引擎通过系统API持续监听通知：
     - Windows：`winrt-notifications`
     - macOS：`pyobjc`访问NSUserNotificationCenter
   - 匹配到"电话"、"微信"、"企业微信"等应用的"来电"或"语音通话"通知
   - AI Agent决策层根据用户配置的接听规则决定是否接听

3. **自动接听执行**：
   - 运行预先录制好的RPA工作流
   - 模拟点击目标应用的"接听"按钮
   - 使用GUI自动化工具（pywinauto/pyobjc）精确定位和点击

4. **音频重定向（核心流程）**：
   
   **步骤1：捕获对方声音**
   ```
   对方说话 → 通话应用 → 系统默认扬声器
                              ↓（切换）
                        VB-CABLE Input（虚拟麦克风）
                              ↓
                        Python引擎捕获音频流
                              ↓
                        阿里云ASR（语音识别）
   ```
   - Python引擎执行系统命令，将操作系统的**默认扬声器**切换为`VB-CABLE Input`
   - 此时对方的声音不再从物理音箱播放，而是被导入虚拟音频管道
   - Python使用`sounddevice`库从虚拟输入端读取音频流
   - 实时发送给阿里云ASR服务进行语音识别

   **步骤2：AI声音输出**
   ```
   AI Agent生成回复文本
          ↓
   阿里云TTS（语音合成）
          ↓
   Python引擎接收音频流
          ↓
   VB-CABLE Output（虚拟扬声器）
          ↓（切换）
   系统默认麦克风 → 通话应用 → 对方听到
   ```
   - Python引擎将操作系统的**默认麦克风**切换为`VB-CABLE Output`
   - AI Agent生成的回复文本发送给阿里云TTS服务
   - 接收合成的音频流，通过`sounddevice`库播放到虚拟输出端
   - 通话应用捕获虚拟麦克风的声音，传输给对方

   **完整音频闭环**：
   ```
   对方声音 → 物理扬声器 → VB-CABLE Input → Python引擎 → 阿里云ASR
                                                    ↓
                                                AI Agent决策
                                                    ↓
   对方听到 ← 物理麦克风 ← VB-CABLE Output ← Python引擎 ← 阿里云TTS
   ```

5. **设备切换命令**：
   - **macOS**：使用`SwitchAudioSource`命令行工具
     ```bash
     # 切换输出设备
     SwitchAudioSource -s "BlackHole 2ch"
     # 切换输入设备
     SwitchAudioSource -s "BlackHole 2ch" -t input
     ```
   - **Windows**：使用`nircmd`或Windows API
     ```bash
     # 切换默认播放设备
     nircmd setdefaultsounddevice "CABLE Input"
     # 切换默认录音设备
     nircmd setdefaultsounddevice "CABLE Output" 1
     ```

6. **通话结束恢复**：
   - 检测到通话结束（挂断通知、静音超时、最大时长）
   - 执行系统命令将音频设备恢复到原始状态
   - 保存通话记录和对话内容
   - 生成通话摘要并上报服务器

7. **异常处理**：
   - 虚拟设备未安装：提示用户安装驱动
   - 设备切换失败：记录错误日志，尝试恢复原设备
   - 音频流中断：自动重连，超过3次失败则挂断
   - 通话应用崩溃：检测到应用退出，立即恢复音频设备

**通话记录**
- **对话记录**: 完整的对话文字记录
- **通话时长**: 记录通话持续时间
- **挂断原因**: AI决定挂断、超时、错误、静音
- **会话ID**: 关联阿里云会话ID
- **上报服务器**: 将通话记录同步到云端
- **查看历史**: 在应用内查看历史通话记录
- **生成摘要**: AI自动生成通话摘要

#### 4.7.2 音频设备管理
- **设备检测**: 列出所有音频输入/输出设备
- **虚拟设备检测**: 检测虚拟音频设备是否安装
- **设备状态**: 显示当前使用的设备
- **设备配置**: 选择麦克风、扬声器、虚拟设备
- **自动切换**: 通话时自动切换到虚拟设备

#### 4.7.3 音频测试
- **虚拟音频测试**: 播放测试音频、录制测试、回环测试
- **阿里云服务测试**: Token获取、ASR、TTS、AI Agent测试

#### 4.7.4 通话统计
- **今日通话数**: 今天的通话次数
- **总通话时长**: 累计通话时长
- **平均通话时长**: 平均每次通话时长
- **接通率**: 成功接听的比例
- **通话历史**: 查看所有通话记录，支持筛选、搜索、导出

---

### 4.8 知识库与记忆系统

#### 4.8.1 知识库管理
- **知识库创建**: 设置名称、描述、嵌入模型、分块策略
- **文档管理**: 
  - 上传（拖拽、批量）
  - 支持格式：PDF、DOCX、XLSX、TXT、MD、HTML、PPT
  - 文档列表、预览、下载、删除
  - 文档状态：待处理、向量化中、已完成、失败
- **向量化处理**: 
  - 自动向量化
  - 存储到向量数据库
  - 分块预览
- **检索测试**: 
  - 输入查询测试检索效果
  - 查看检索结果和相似度得分
  - 调试信息
- **统计分析**: 文档数量、向量数量、检索次数、平均相似度

#### 4.8.2 记忆系统
- **短期记忆**: 
  - 当前对话上下文
  - 滑动窗口机制
  - 自动摘要压缩
  - 会话隔离
- **长期记忆**: 
  - 跨会话记忆
  - 知识提取
  - 话题分类
  - 记忆快照
  - 云端同步
- **工作记忆**: 
  - 任务状态
  - 临时变量
  - 中间结果
  - 上下文引用
- **记忆管理**: 
  - 记忆列表
  - 搜索、编辑、删除
  - 导出记忆数据

#### 4.8.3 RAG（检索增强生成）
- **检索策略**: 
  - 向量检索（语义）
  - 关键词检索（BM25）
  - 混合检索
  - Top-K配置
- **Rerank重排序**: 
  - 二次精细排序
  - 专用Rerank模型
  - 相关性提升
- **引用管理**: 
  - 标记引用来源
  - 显示引用片段
  - 溯源链接
  - 置信度显示

---

### 4.9 工具与治理

#### 4.9.1 工具商店
- **工具浏览**: 
  - 按类别浏览（Workflow、MCP、HTTP、Custom）
  - 工具搜索和标签筛选
  - 工具详情查看
- **工具管理**: 
  - 工具注册、编辑、删除
  - 工具启用/禁用
- **工具权限**: 
  - 审批策略配置
  - 审批人设置
  - 审计通道
  - 速率限制

#### 4.9.2 工具审批对话框
- **审批流程**: 
  - 审批请求触发
  - 显示工具信息（名称、参数、原因）
  - 批准/拒绝操作
  - 审批记录
- **自动审批规则**: 
  - 信任Agent自动批准
  - 白名单工具无需审批
  - 基于参数值的自动审批

#### 4.9.3 运营治理面板
- **KPI指标**: 
  - Agent调用量、工具调用量、工作流执行量
  - 成功率、平均响应时间
  - Token消耗、用户满意度
- **趋势分析**: 
  - 调用趋势、性能趋势、错误趋势
  - 对比分析
- **工具调用审计**: 
  - 调用记录详情
  - 调用时间、调用者、参数、结果
  - 执行时长、审批状态
- **告警管理**: 
  - 告警规则配置
  - 告警通知
  - 告警历史

---

### 4.10 工作流执行与任务管理

#### 4.10.1 工作流执行
- **手动执行**: 手动触发工作流
- **参数输入**: 填写工作流参数
- **参数记忆**: 记住上次输入
- **参数模板**: 保存常用参数组合
- **实时日志**: 查看实时执行日志
- **进度显示**: 显示执行进度百分比
- **暂停/恢复**: 支持暂停和恢复
- **终止执行**: 强制终止工作流

#### 4.10.2 执行状态
- Pending（等待执行）
- Running（执行中）
- Paused（已暂停）
- Completed（执行成功）
- Failed（执行失败）
- Cancelled（已取消）

#### 4.10.3 执行结果
- **节点结果**: 每个节点的执行结果
- **变量快照**: 各作用域变量的最终值
- **截图记录**: 节点执行前后的截图
- **执行时长**: 总时长和每个节点时长
- **错误信息**: 失败节点的错误详情

#### 4.10.4 任务队列
- **任务管理**: 
  - 任务列表、筛选、排序、搜索
  - 批量操作（执行、取消、删除）
- **任务优先级**: High（高）、Medium（中）、Low（低）
- **任务操作**: 
  - 立即执行（跳过队列）
  - 取消任务
  - 重试任务
  - 查看详情和日志

#### 4.10.5 工作流触发器
- **通知触发**: 系统通知触发工作流
  - 通知来源：企业微信、微信、系统
  - 关键词匹配（OR关系）
  - 排除关键词
  - 发送人过滤
  - 优先级配置
- **定时触发**: 按计划定时执行（规划中）
- **Webhook触发**: 外部Webhook调用（规划中）
- **消息触发**: 消息事件触发（规划中）

---

### 4.11 系统监控与管理

#### 4.11.1 系统信息
- **基础信息**: 操作系统、系统架构、Node版本、Electron版本、应用版本
- **实时监控**: CPU使用率、内存使用、磁盘使用、网络状态

#### 4.11.2 日志管理
- **日志记录**: 
  - 日志级别：Debug、Info、Warn、Error
  - 日志分类：系统、任务、消息、通话、错误
  - 日志格式：时间戳、级别、模块、消息
  - 日志轮转
- **日志查看**: 
  - 实时日志输出
  - 按级别、分类、关键词筛选
  - 搜索和导出
- **日志上报**: 
  - 定期上报到服务器
  - 错误立即上报
  - 异常捕获

#### 4.11.3 通知管理
- **系统通知**: 
  - 任务接收通知
  - AI暂停通知
  - 任务失败通知
  - 声音提示
- **通知中心**: 
  - 通知列表
  - 未读标记
  - 通知操作（跳转相关页面）
  - 通知清理

#### 4.11.4 文件下载管理
- **下载功能**: 
  - 从服务器下载文件
  - 下载进度显示
  - 断点续传
  - 下载历史
- **下载管理**: 
  - 暂停/恢复
  - 取消下载
  - 打开文件/文件夹

#### 4.11.5 更新服务
- **自动更新**: 
  - 检查更新
  - 更新提示
  - 下载更新
  - 安装更新并重启
- **更新配置**: 
  - 自动检查开关
  - 更新通道（Stable、Beta、Dev）
  - 静默更新
  - 强制更新

---

### 4.12 系统软件扫描

#### 4.12.1 扫描能力（跨平台）
**macOS扫描**:
- 扫描路径：/Applications、~/Applications、/System/Applications
- Info.plist解析
- system_profiler系统工具
- 应用信息：Bundle ID、名称、版本、路径、图标

**Windows扫描**:
- WMI查询：Win32_Product
- 注册表扫描：HKLM/HKCU Uninstall路径
- 开始菜单扫描
- 应用信息：显示名称、发布者、版本、路径、可执行文件名

**通用能力**:
- 进程名猜测
- 版本解析（semver）
- 缓存机制

#### 4.12.2 兼容性推荐
- 自动匹配工作流的目标应用
- 推荐兼容的工作流
- 版本匹配检查（semver范围）
- 跨平台提示

---

### 4.13 MCP Tool集成

#### 4.13.1 MCP服务器管理
- **连接MCP Server**: 配置服务器连接
- **工具发现**: 自动发现MCP工具
- **工具列表**: 查看所有可用工具

#### 4.13.2 工作流注册为MCP Tool
- **自动注册**: 将工作流注册为MCP Tool
- **工具定义生成**: 自动生成Tool Definition
- **描述生成**: 根据工作流信息生成AI描述
- **参数映射**: 工作流参数映射为Tool Parameters
- **AI调用**: AI可以调用工作流

#### 4.13.3 AI调用配置
- **启用AI调用**: 开关工作流的AI调用能力
- **工具名称**: 自定义工具名称
- **AI描述**: 供AI理解的描述
- **AI示例**: 提供调用示例
- **参数描述**: 每个参数的详细说明
- **速率限制**: 限制调用频率
- **需要确认**: 是否需要用户确认

---

### 4.14 WebSocket远程触发

#### 4.14.1 远程执行
- **执行命令**: 服务器通过WebSocket下发工作流执行命令
- **参数传递**: 远程传递工作流参数
- **异步执行**: 工作流异步执行，不阻塞WebSocket
- **执行响应**: 返回执行ID和初始状态

#### 4.14.2 状态同步
- **状态更新**: 实时推送工作流执行状态
- **进度报告**: 报告执行进度
- **结果上报**: 执行完成后上报结果
- **错误报告**: 执行失败时报告错误信息

---

## 5. 移动端功能需求

### 5.1 产品定位

移动端作为PC端的监控和管理工具，主要功能是：
- 实时监控PC端工作流和Agent执行状态
- 远程控制PC端任务
- 接收通知和告警
- 查看统计报表
- 随时随地管理"贾维斯"

**注意**: 移动端不执行复杂的自动化任务，所有任务执行均在PC端完成。

### 5.2 核心功能模块

#### 5.2.1 首页仪表盘
- **实时状态**: 
  - PC在线状态（在线/离线）
  - 当前执行的任务数量
  - 今日执行任务数、成功率
  - 当前通话状态
- **快速操作**: 
  - 远程执行常用工作流
  - 暂停/恢复PC端任务
  - 查看最新通知
- **统计卡片**: 
  - 本周任务执行趋势图
  - Agent调用次数
  - 通话时长统计

#### 5.2.2 实时监控
- **PC设备列表**: 
  - 查看所有已登录的PC设备
  - 设备在线状态
  - 设备基本信息（操作系统、版本、IP）
  - 切换监控的设备
- **执行中任务**: 
  - 实时显示正在执行的工作流
  - 执行进度百分比
  - 当前执行节点
  - 实时日志流
- **暂停/终止**: 
  - 远程暂停任务
  - 远程终止任务
  - 确认对话框防误操作

#### 5.2.3 任务管理
- **任务列表**: 
  - 等待中任务
  - 执行历史记录
  - 按状态筛选（Pending、Running、Completed、Failed、Cancelled）
  - 按时间排序
- **任务操作**: 
  - 远程触发工作流执行
  - 填写工作流参数（表单式）
  - 取消等待中的任务
  - 重试失败的任务
- **任务详情**: 
  - 查看任务详细信息
  - 执行日志
  - 节点执行结果
  - 截图查看
  - 变量快照

#### 5.2.4 通话记录
- **通话列表**: 
  - 所有AI接听的通话记录
  - 按时间倒序排列
  - 显示来电人、时长、挂断原因
- **通话详情**: 
  - 完整对话文字记录
  - 通话摘要
  - 通话时长
  - 关键信息提取（姓名、电话、诉求）
- **筛选和搜索**: 
  - 按日期筛选
  - 按来电人搜索
  - 按关键词搜索对话内容

#### 5.2.5 通知中心
- **通知列表**: 
  - 所有通知按时间倒序
  - 未读标记
  - 通知类型图标（任务、通话、系统、告警）
- **通知详情**: 
  - 查看通知详细内容
  - 快速跳转到相关页面
- **通知设置**: 
  - 开启/关闭推送通知
  - 选择接收的通知类型
  - 免打扰时间段

#### 5.2.6 Agent管理
- **Agent列表**: 
  - 查看所有Agent
  - Agent状态（在线/离线/执行中）
  - Agent基本信息
- **Agent操作**: 
  - 启动/停止Agent
  - 查看Agent执行历史
  - 查看Agent性能指标
- **会话管理**: 
  - 与Agent进行对话
  - 查看会话历史
  - 发送文本、图片、文件

#### 5.2.7 工作流管理
- **工作流列表**: 
  - 查看所有工作流
  - 按分类、标签筛选
  - 搜索工作流
- **工作流详情**: 
  - 查看工作流基本信息
  - 查看工作流节点（简化展示）
  - 执行历史统计
- **远程执行**: 
  - 选择工作流
  - 填写参数（表单式）
  - 触发PC端执行
  - 查看执行进度

#### 5.2.8 统计报表
- **任务统计**: 
  - 今日/本周/本月执行任务数
  - 成功率趋势图
  - 执行时长统计
  - 失败原因分析
- **通话统计**: 
  - 通话次数和时长
  - 接通率
  - 平均通话时长
  - 来电人分布
- **Agent统计**: 
  - Agent调用次数
  - Token消耗统计
  - 响应时间分析
  - 成功率统计
- **导出报表**: 
  - 生成PDF/Excel报表
  - 分享报表

#### 5.2.9 设置
- **账号管理**: 
  - 查看账号信息
  - 修改密码
  - 退出登录
- **设备管理**: 
  - 查看已登录设备
  - 解绑设备
  - 设备授权管理
- **通知设置**: 
  - 推送通知开关
  - 通知类型选择
  - 免打扰时间
- **数据同步**: 
  - 同步设置
  - 数据使用统计
- **关于**: 
  - 版本信息
  - 用户协议
  - 隐私政策
  - 帮助中心

### 5.3 用户交互设计

#### 5.3.1 导航结构
- **底部Tab栏**: 
  - 首页（仪表盘）
  - 任务（任务管理）
  - 通话（通话记录）
  - 通知（通知中心）
  - 我的（设置）

#### 5.3.2 实时更新
- **WebSocket连接**: 与云端保持长连接，实时推送状态更新
- **推送通知**: 关键事件触发系统推送通知
- **自动刷新**: 任务状态、执行进度自动刷新

#### 5.3.3 离线处理
- **离线提示**: PC离线时显示明确提示
- **缓存数据**: 缓存历史数据，离线也可查看
- **操作队列**: 离线时的操作加入队列，上线后执行

---

## 6. 管理后台功能需求

### 6.1 产品定位

管理后台是面向企业管理员、平台运营者的Web管理系统，主要功能：
- 用户管理和权限控制
- 数据存储和备份
- 模板市场管理
- 付费和会员管理
- 模型管理
- 运营数据分析

### 6.2 核心功能模块

#### 6.2.1 用户管理

**用户列表**
- **用户信息**: 
  - 用户ID、用户名、邮箱、手机号
  - 注册时间、最后登录时间
  - 会员等级、到期时间
  - 账号状态（正常/冻结/注销）
- **筛选和搜索**: 
  - 按会员等级筛选
  - 按注册时间筛选
  - 按账号状态筛选
  - 搜索用户名、邮箱、手机号
- **批量操作**: 
  - 批量发送消息
  - 批量调整会员等级
  - 批量导出

**用户详情**
- **基本信息**: 
  - 查看和编辑用户基本信息
  - 修改密码
  - 调整会员等级
- **设备管理**: 
  - 查看用户已登录的设备
  - 强制下线设备
  - 查看设备活跃情况
- **使用统计**: 
  - 工作流执行次数
  - Agent调用次数
  - Token消耗量
  - 存储空间使用
- **付费记录**: 
  - 查看充值记录
  - 查看购买记录
  - 查看消费记录
- **操作日志**: 
  - 查看用户操作日志
  - 敏感操作记录
  - 异常行为记录

**用户操作**
- **冻结账号**: 冻结违规账号
- **解冻账号**: 解除冻结
- **重置密码**: 管理员重置用户密码
- **发送消息**: 向用户发送系统消息
- **调整配额**: 调整用户的使用配额（存储、Token等）

#### 6.2.2 权限管理

**角色管理**
- **预设角色**: 
  - 超级管理员：所有权限
  - 运营管理员：用户管理、内容管理
  - 财务管理员：付费数据查看
  - 审核管理员：模板审核
  - 客服：查看用户信息、处理工单
- **自定义角色**: 
  - 创建自定义角色
  - 配置角色权限
  - 删除角色

**权限配置**
- **功能权限**: 
  - 用户管理（查看/编辑/删除）
  - 模板管理（查看/审核/下架）
  - 财务管理（查看/导出）
  - 系统设置（查看/修改）
- **数据权限**: 
  - 查看所有用户数据
  - 查看部门用户数据
  - 仅查看自己的数据

**管理员账号**
- **管理员列表**: 查看所有管理员
- **添加管理员**: 创建新管理员账号
- **分配角色**: 为管理员分配角色
- **操作日志**: 查看管理员操作日志

#### 6.2.3 数据管理

**数据存储**
- **存储统计**: 
  - 总存储空间使用量
  - 各类型数据占比（工作流、知识库、通话记录等）
  - 用户存储空间排行
- **存储配置**: 
  - 默认存储配额
  - 会员存储配额
  - 存储扩容设置
- **数据清理**: 
  - 清理过期数据
  - 清理临时文件
  - 释放存储空间

**数据备份**
- **备份策略**: 
  - 自动备份时间配置
  - 备份保留周期
  - 增量备份/全量备份
- **备份记录**: 
  - 查看所有备份记录
  - 备份时间、大小、状态
- **备份操作**: 
  - 立即执行备份
  - 恢复到指定备份
  - 下载备份文件
  - 删除备份

**数据导出**
- **用户数据导出**: 导出用户列表、统计数据
- **业务数据导出**: 导出工作流、Agent、通话记录等
- **财务数据导出**: 导出订单、流水等
- **格式支持**: CSV、Excel、JSON

#### 6.2.4 模板市场管理

**工作流模板管理**
- **模板列表**: 
  - 所有工作流模板
  - 模板信息：名称、描述、创建者、价格、销量
  - 模板状态：待审核、已上架、已下架、已拒绝
- **模板审核**: 
  - 查看模板详情
  - 预览工作流节点
  - 审核意见填写
  - 批准/拒绝操作
- **模板分类**: 
  - 创建/编辑/删除分类
  - 分类排序
  - 热门分类设置
- **模板标签**: 
  - 创建/编辑/删除标签
  - 标签管理
- **模板操作**: 
  - 设置推荐
  - 设置热门
  - 调整价格
  - 下架模板

**Agent模板管理**
- **模板列表**: 
  - 所有Agent模板
  - 模板信息：名称、描述、创建者、价格、销量
  - 模板状态：待审核、已上架、已下架、已拒绝
- **模板审核**: 
  - 查看Agent配置详情
  - 测试Agent对话效果
  - 审核意见填写
  - 批准/拒绝操作
- **模板分类**: 
  - 客服类、分析类、创作类、研究类、协作类
  - 自定义分类
- **模板操作**: 
  - 设置推荐
  - 设置热门
  - 调整价格
  - 下架模板

**模板统计**
- **销售统计**: 
  - 总销售额
  - 销量排行榜
  - 销售趋势图
  - 热门模板分析
- **用户行为**: 
  - 浏览量统计
  - 下载量统计
  - 收藏量统计
  - 转化率分析
- **创作者统计**: 
  - 创作者收益排行
  - 模板数量统计
  - 平均评分

#### 6.2.5 付费与会员管理

**会员体系**
- **会员等级**: 
  - 免费版：基础功能，有配额限制
  - 个人版：完整功能，较高配额
  - 专业版：高级功能，无限配额
  - 企业版：团队协作，企业级支持
- **会员权益**: 
  - 工作流执行次数配额
  - Agent调用次数配额
  - Token使用配额
  - 存储空间配额
  - 知识库文档数量
  - 并发任务数量
  - 模板下载数量
  - 技术支持等级
- **会员价格**: 
  - 月付/年付价格设置
  - 优惠折扣配置
  - 促销活动设置

**订单管理**
- **订单列表**: 
  - 所有订单记录
  - 订单信息：订单号、用户、商品、金额、状态
  - 订单状态：待支付、已支付、已取消、已退款
- **订单筛选**: 
  - 按时间筛选
  - 按订单状态筛选
  - 按商品类型筛选（会员、模板、Token）
  - 按金额范围筛选
- **订单详情**: 
  - 查看订单详细信息
  - 支付信息
  - 发票信息
- **订单操作**: 
  - 手动确认订单
  - 订单退款
  - 取消订单
  - 导出订单

**支付管理**
- **支付渠道**: 
  - 微信支付
  - 支付宝
  - 信用卡支付（海外）
  - PayPal（海外）
- **支付配置**: 
  - 支付渠道开关
  - 支付参数配置
  - 支付回调配置
- **支付流水**: 
  - 查看所有支付流水
  - 支付时间、金额、渠道、状态
  - 对账功能

**退款管理**
- **退款申请**: 
  - 查看所有退款申请
  - 申请信息：用户、订单、原因、时间
  - 申请状态：待审核、已批准、已拒绝、已退款
- **退款审核**: 
  - 查看退款详情
  - 审核意见填写
  - 批准/拒绝操作
- **退款记录**: 
  - 所有退款记录
  - 退款金额统计

**发票管理**
- **发票申请**: 
  - 查看所有发票申请
  - 申请信息：用户、订单、抬头、税号
  - 申请状态：待开具、已开具、已邮寄
- **发票开具**: 
  - 开具电子发票
  - 开具纸质发票
  - 发票邮寄管理
- **发票记录**: 
  - 所有发票记录
  - 发票查询和下载

#### 6.2.6 模型管理

**模型配置**
- **LLM模型管理**: 
  - 支持的模型列表（OpenAI、Claude、Coze、本地模型）
  - 模型API配置
  - 模型参数配置（Temperature、Max Tokens等）
  - 模型启用/禁用
- **嵌入模型管理**: 
  - 向量化模型列表
  - 模型维度配置
  - 模型性能配置
- **模型优先级**: 
  - 设置默认模型
  - 配置模型降级策略
  - 负载均衡配置

**模型调用统计**
- **调用量统计**: 
  - 各模型调用次数
  - Token消耗统计
  - 调用趋势图
- **成本分析**: 
  - 各模型成本统计
  - 用户成本排行
  - 成本趋势分析
- **性能监控**: 
  - 响应时间统计
  - 成功率统计
  - 错误率分析

**模型配额管理**
- **全局配额**: 
  - 设置平台总配额
  - 各模型分配配额
- **用户配额**: 
  - 免费用户配额
  - 付费用户配额
  - 企业用户配额
- **配额预警**: 
  - 配额使用预警
  - 超额使用告警

#### 6.2.7 运营数据分析

**用户数据**
- **用户增长**: 
  - 新增用户趋势图
  - 累计用户数
  - 用户增长率
- **用户活跃**: 
  - 日活跃用户（DAU）
  - 月活跃用户（MAU）
  - 用户留存率（次日、7日、30日）
- **用户画像**: 
  - 用户地域分布
  - 用户操作系统分布
  - 用户会员等级分布

**业务数据**
- **工作流数据**: 
  - 工作流创建数量
  - 工作流执行次数
  - 工作流成功率
  - 热门工作流排行
- **Agent数据**: 
  - Agent创建数量
  - Agent调用次数
  - Agent类型分布
  - 热门Agent排行
- **通话数据**: 
  - 通话总次数
  - 通话总时长
  - 平均通话时长
  - 接通率统计

**财务数据**
- **收入统计**: 
  - 总收入
  - 收入趋势图
  - 收入来源分析（会员、模板、Token）
- **用户价值**: 
  - ARPU（每用户平均收入）
  - LTV（用户生命周期价值）
  - 付费转化率
- **模板市场**: 
  - 模板销售额
  - 平台抽成收入
  - 创作者收益

**系统数据**
- **资源使用**: 
  - 服务器资源使用情况
  - 存储空间使用情况
  - 带宽使用情况
- **性能指标**: 
  - API响应时间
  - 任务执行成功率
  - 系统可用性
- **错误监控**: 
  - 错误次数统计
  - 错误类型分布
  - 错误趋势分析

#### 6.2.8 内容管理

**公告管理**
- **公告列表**: 查看所有公告
- **创建公告**: 
  - 公告标题、内容
  - 公告类型（系统维护、功能更新、活动通知）
  - 发布时间、结束时间
  - 目标用户（全部/指定会员等级）
- **公告操作**: 
  - 编辑公告
  - 删除公告
  - 置顶公告

**帮助文档**
- **文档分类**: 
  - 快速入门
  - 功能教程
  - 常见问题
  - API文档
- **文档管理**: 
  - 创建/编辑/删除文档
  - 文档排序
  - 文档搜索
- **文档统计**: 
  - 文档浏览量
  - 热门文档排行

**反馈管理**
- **反馈列表**: 
  - 所有用户反馈
  - 反馈类型：Bug、功能建议、使用问题、其他
  - 反馈状态：待处理、处理中、已完成、已关闭
- **反馈处理**: 
  - 查看反馈详情
  - 回复用户
  - 标记状态
  - 分配处理人
- **反馈统计**: 
  - 反馈数量趋势
  - 反馈类型分布
  - 处理时效统计

#### 6.2.9 系统设置

**基础设置**
- **平台信息**: 
  - 平台名称、Logo
  - 联系方式
  - 备案信息
- **邮件配置**: 
  - SMTP服务器配置
  - 邮件模板管理
- **短信配置**: 
  - 短信服务商配置
  - 短信模板管理

**安全设置**
- **登录安全**: 
  - 密码强度要求
  - 登录失败限制
  - 多设备登录策略
- **API安全**: 
  - API密钥管理
  - 访问频率限制
  - IP白名单
- **数据安全**: 
  - 数据加密配置
  - 敏感数据脱敏
  - 审计日志保留期

**系统监控**
- **服务状态**: 
  - 各服务运行状态
  - 服务健康检查
- **告警配置**: 
  - 告警规则配置
  - 告警通知渠道
  - 告警接收人
- **日志管理**: 
  - 系统日志查看
  - 日志筛选和搜索
  - 日志导出

---

## 7. 技术架构概览

### 7.1 PC端核心架构（驾驶舱与引擎分离）

本架构的核心是**"驾驶舱与引擎分离"**的设计哲学，确保前端UI的流畅性和跨平台一致性，同时将复杂的自动化逻辑完全解耦到独立的后端引擎中。

```
+-----------------------------------------------------------------------------------+
|                                  用户交互层                                       |
|                    (工作流设计, 自然语言指令, 状态监控)                            |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (1) 用户操作/指令                          | (6) 结果/状态反馈
      v                                        |
+-----------------------------------------------------------------------------------+
|                      前端应用: 贾维斯驾驶舱 (Tauri 2 + React)                         |
|                                                                                   |
|  +--------------------------+  +--------------------------+  +------------------+  |
|  |   工作流设计器 (React Flow)  |  |      AI助理交互界面      |  |     系统设置     |  |
|  |   (包含用于高亮的叠加窗口)    |  |     (极简聊天/命令栏)     |  |     (React)      |  |
|  +--------------------------+  +--------------------------+  +------------------+  |
|                                                                                   |
|-----------------------------------------------------------------------------------|
|                      通信桥梁: Tauri Rust 核心                                    |
|              (管理Sidecar生命周期, 通过IPC或本地HTTP与引擎通信)                     |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (2) 格式化指令 (JSON)                   | (5) 实时事件/数据
      v                                        |
+-----------------------------------------------------------------------------------+
|                    核心引擎: Python Sidecar (独立可执行文件)                        |
|                                                                                   |
|  +-----------------------------------------------------------------------------+  |
|  |                    (A) 决策层: AI多智能体系统 (AgentScope)                    |  |
|  |  [主管Agent] -> [RPA Agent], [通信Agent], [分析Agent] ...                  |  |
|  |  (解析指令、任务规划、决策、调用下层工具)                                        |  |
|  +-----------------------------------------------------------------------------+  |
|  |                     (B) 能力层: 工具集 (Toolbox)                             |  |
|  |                                                                             |  |
|  | +-----------------+ +-------------------+ +---------------------------------+ |  |
|  | | GUI自动化工具   | | Web自动化工具     | | 系统级集成工具                  | |  |
|  | | - pywinauto     | | - Playwright      | | - 通知监听 (winrt-notifications) | |  |
|  | | - pyobjc        | | - OCR (Tesseract) | | - 虚拟音频 (VB-CABLE/BlackHole) | |  |
|  | | - 事件监听(pynput)| |                   | | - 虚拟摄像头 (pyvirtualcam)    | |  |
|  | +-----------------+ +-------------------+ +---------------------------------+ |  |
|  +-----------------------------------------------------------------------------+  |
+-----------------------------------------------------------------------------------+
      |                                        ^
      | (3) 底层API调用/脚本执行                  | (4) 从系统/应用捕获数据
      v                                        |
+-----------------------------------------------------------------------------------+
|                      操作系统与目标应用程序 (Windows/macOS)                         |
+-----------------------------------------------------------------------------------+
```

**架构说明**：

1. **前端应用（驾驶舱）**：
   - 使用Tauri 2框架，基于Rust后端和原生WebView
   - React构建的UI，负责所有用户交互
   - 包含透明叠加窗口用于元素高亮显示
   - 不执行任何自动化逻辑，仅负责呈现和交互

2. **通信桥梁（Tauri Rust核心）**：
   - 管理Python Sidecar进程的生命周期
   - 通过IPC或本地HTTP与后端引擎通信
   - 提供前端调用后端的安全接口

3. **核心引擎（Python Sidecar）**：
   - 使用PyInstaller打包为独立可执行文件
   - **决策层**：基于AgentScope的Multi-Agent系统
   - **能力层**：集成所有自动化工具和系统集成能力
   - 完全独立运行，不依赖前端

4. **关键技术选型理由**：
   - **AgentScope vs LangChain**：AgentScope专为多智能体应用设计，原生支持Agent协同和消息驱动通信
   - **Playwright**：支持持久化浏览器上下文（`launch_persistent_context`），完美解决登录状态保持问题
   - **pywinauto/pyobjc**：直接与操作系统辅助功能API交互，实现稳定可靠的元素定位
   - **pynput**：全局键鼠事件监听，是录制器的核心

### 7.2 三端整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户交互层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  PC客户端    │  │  移动端App   │  │  管理后台    │         │
│  │  (Tauri 2)   │  │(React Native)│  │  (React)     │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕ HTTPS/WebSocket
┌─────────────────────────────────────────────────────────────────┐
│                          API网关层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  负载均衡    │  │  API网关     │  │  鉴权中心    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────────┐
│                          业务服务层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  用户服务    │  │  工作流服务  │  │  Agent服务   │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  模板服务    │  │  支付服务    │  │  通知服务    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────────┐
│                          数据存储层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  PostgreSQL  │  │  MongoDB     │  │  Redis       │         │
│  │  (关系数据)  │  │  (文档数据)  │  │  (缓存)      │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  向量数据库  │  │  对象存储    │  │  消息队列    │         │
│  │  (Qdrant)    │  │  (OSS)       │  │  (RabbitMQ)  │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

### 7.2 PC端技术架构

**前端技术栈**
- **框架**: Tauri 2
- **UI库**: React 18
- **状态管理**: Zustand
- **工作流引擎**: React Flow
- **样式**: Tailwind CSS
- **图表**: ECharts
- **通信**: WebSocket、HTTP

**后端引擎（Python Sidecar）**
- **框架**: FastAPI
- **AI决策**: AgentScope
- **GUI自动化**: 
  - macOS: pyobjc
  - Windows: pywinauto
- **Web自动化**: Playwright
- **OCR**: Tesseract
- **音频**: pydub、sounddevice
- **打包**: PyInstaller

### 7.3 移动端技术架构

**技术栈**
- **框架**: React Native
- **状态管理**: Redux Toolkit
- **导航**: React Navigation
- **UI组件**: React Native Paper
- **图表**: react-native-chart-kit
- **推送**: Firebase Cloud Messaging (FCM)
- **本地存储**: AsyncStorage

### 7.4 后台界面技术架构

**技术栈**
- **框架**: React 18
- **UI组件**: Ant Design Pro
- **状态管理**: Redux Toolkit
- **路由**: React Router v6
- **图表**: ECharts
- **表格**: Ant Design Table
- **富文本**: Quill

### 7.5 后台服务技术架构

**后端技术栈**
- **语言**: Go
- **框架**: Gin / Fiber（轻量级高性能Web框架）
- **BaaS平台**: Supabase（提供数据库、认证、存储、实时订阅等一体化服务）
- **API文档**: Swagger
- **认证**: Supabase Auth（内置JWT认证）
- **实时通信**: Supabase Realtime（基于PostgreSQL的实时订阅）

**Supabase集成说明**

Supabase是一个开源的Firebase替代方案，提供完整的后端即服务（BaaS）能力。所有用户数据统一存储在我们的Supabase项目中。

**核心能力**：
- **PostgreSQL数据库**: 
  - 用户信息、工作流定义、Agent配置、订单数据、权限管理等
  - 支持复杂查询、事务、触发器
  - 内置Row Level Security（RLS）实现数据隔离
  
- **Supabase Auth**: 
  - 用户注册、登录、JWT Token管理
  - 支持邮箱密码、第三方OAuth（微信、Google等）
  - 自动处理Token刷新和会话管理
  
- **Supabase Storage**: 
  - 工作流模板文件、知识库文档、通话录音、用户头像等
  - 支持大文件上传、断点续传
  - 自动CDN加速
  
- **Supabase Realtime**: 
  - PC端与云端的实时状态同步
  - 移动端实时监控PC端任务执行
  - 基于PostgreSQL的LISTEN/NOTIFY机制
  
- **Edge Functions**: 
  - 部署轻量级Serverless函数处理特定业务逻辑
  - 如：支付回调、数据统计、定时任务等

**Go后端服务职责**：
- **API网关**: 统一的RESTful API入口，处理业务逻辑
- **业务编排**: 协调Supabase各服务，实现复杂业务流程
- **第三方集成**: 对接LLM服务、支付服务、推送服务等
- **性能优化**: 缓存、批量处理、异步任务队列
- **安全增强**: API限流、参数校验、敏感操作审计

**数据存储方案**：
- **PostgreSQL（Supabase内置）**: 
  - 用户、工作流、Agent、订单、权限、日志等结构化数据
  - 使用pgvector扩展实现向量存储（知识库）
  
- **Supabase Storage**: 
  - 文件、模板、文档、音频、图片等非结构化数据
  
- **Redis（可选）**: 
  - 高频访问数据缓存
  - 分布式锁
  - 任务队列（使用Go的Asynq库）

**第三方服务**
- **LLM服务**: OpenAI、Claude、Coze
- **语音服务**: 阿里云智能媒体服务
- **支付服务**: 微信支付、支付宝、Stripe
- **推送服务**: Firebase Cloud Messaging
- **监控服务**: Sentry、Prometheus

**技术优势**：
- ✅ **快速开发**: Supabase提供开箱即用的后端能力，减少基础设施搭建时间
- ✅ **高性能**: Go的高并发能力 + PostgreSQL的稳定性
- ✅ **统一管理**: 所有用户数据集中在一个Supabase项目中，便于管理和备份
- ✅ **实时能力**: Supabase Realtime原生支持，无需额外WebSocket服务器
- ✅ **成本可控**: 按需付费，初期成本低，支持平滑扩展
- ✅ **开源生态**: Supabase开源，可自托管，避免厂商锁定

---

## 8. 非功能性需求

### 8.1 性能要求

**PC端性能**
- **启动时间**: 应用冷启动时间 < 3秒
- **内存占用**: 空闲状态 < 200MB，执行任务时 < 500MB
- **CPU占用**: 空闲状态 < 5%，执行任务时 < 30%
- **响应时间**: UI操作响应 < 100ms
- **工作流执行**: 简单工作流 < 5秒，复杂工作流根据节点数量线性增长

**移动端性能**
- **启动时间**: 冷启动 < 2秒
- **内存占用**: < 100MB
- **流量消耗**: 正常使用 < 10MB/天
- **电量消耗**: 后台运行对电量影响 < 5%/小时

**云端性能**
- **API响应时间**: P95 < 200ms
- **并发支持**: 支持10000+并发用户
- **数据库查询**: 复杂查询 < 500ms
- **文件上传**: 支持100MB文件上传

### 8.2 可用性要求

**系统可用性**
- **目标可用性**: 99.9%（每月停机时间 < 43分钟）
- **故障恢复**: RTO < 1小时，RPO < 15分钟
- **数据备份**: 每日全量备份，实时增量备份
- **灾备方案**: 异地多活，自动故障转移

**用户体验**
- **离线可用**: PC端支持离线执行本地工作流
- **断线重连**: 网络断开后自动重连，恢复状态
- **错误提示**: 友好的错误提示和解决建议
- **操作引导**: 新用户引导、功能提示

### 8.3 安全性要求

**数据安全**
- **传输加密**: HTTPS、WSS加密传输
- **存储加密**: 敏感数据AES-256加密存储
- **密钥管理**: 系统密钥库存储（Keychain/Credential Manager）
- **数据脱敏**: 日志中敏感信息脱敏

**访问安全**
- **身份认证**: JWT Token，支持双因素认证
- **权限控制**: RBAC角色权限控制
- **API安全**: API密钥、签名验证、频率限制
- **审计日志**: 所有敏感操作记录审计日志

**隐私保护**
- **数据最小化**: 只收集必要的用户数据
- **用户授权**: 敏感权限需明确授权
- **数据删除**: 支持用户删除所有数据
- **隐私政策**: 明确的隐私政策和用户协议

### 8.4 兼容性要求

**PC端兼容性**
- **操作系统**: 
  - macOS 11.0+
  - Windows 10/11
- **屏幕分辨率**: 1280x720 及以上
- **浏览器**: Chrome 90+、Edge 90+、Firefox 88+、Safari 14+

**移动端兼容性**
- **iOS**: iOS 13.0+
- **Android**: Android 8.0+
- **屏幕尺寸**: 支持4.7寸至12.9寸屏幕

**浏览器兼容性（管理后台）**
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

### 8.5 可扩展性要求

**系统扩展**
- **水平扩展**: 支持服务器水平扩展
- **模块化设计**: 各功能模块独立，易于扩展
- **插件机制**: 支持第三方插件扩展
- **API开放**: 提供完整的API供第三方集成

**数据扩展**
- **数据库分片**: 支持数据库分片扩展
- **存储扩展**: 支持对象存储无限扩展
- **缓存扩展**: 支持Redis集群扩展

### 8.6 可维护性要求

**代码质量**
- **代码规范**: 统一的代码风格和规范
- **单元测试**: 核心功能单元测试覆盖率 > 80%
- **集成测试**: 关键流程集成测试覆盖
- **文档完善**: 完整的技术文档和API文档

**监控运维**
- **日志系统**: 完善的日志记录和查询
- **监控告警**: 实时监控和告警通知
- **性能分析**: 性能瓶颈分析工具
- **故障排查**: 快速定位和解决问题的工具

### 8.7 国际化要求

**语言支持**
- **初期**: 简体中文
- **后期**: 英文、繁体中文、日文、韩文

**本地化**
- **时区**: 自动识别用户时区
- **货币**: 支持多种货币显示
- **日期格式**: 根据地区显示日期格式

---

## 9. 产品路线图

### 9.1 MVP版本（V1.0）- 3个月

**核心功能**
- ✅ 用户认证和账号管理
- ✅ 工作流设计器（基础节点）
- ✅ 智能录制器
- ✅ 工作流执行引擎
- ✅ Basic Agent
- ✅ 简单的知识库管理
- ✅ PC端基础UI
- ✅ 云端基础服务（用户、工作流存储）

**目标**
- 验证核心价值：工作流自动化能力
- 获取早期用户反馈
- 打磨基础功能体验

### 9.2 增强版本（V1.5）- 2个月

**新增功能**
- ✅ ReAct Agent
- ✅ Agent工具调用
- ✅ 工作流高级节点（HTTP、MCP、AI Process）
- ✅ 工作流触发器（通知触发）
- ✅ 移动端基础版（监控、通知）
- ✅ 管理后台基础版（用户管理、数据管理）

**目标**
- 增强AI能力
- 支持移动端监控
- 支持基础的管理功能

### 9.3 专业版本（V2.0）- 3个月

**新增功能**
- ✅ Deep Research Agent
- ✅ Multi-Agent协同（工作流编排、组织架构）
- ✅ AI智能接听（语音通话）
- ✅ 完整的知识库和记忆系统
- ✅ 工具商店和治理
- ✅ 移动端完整版
- ✅ 管理后台完整版（模板市场、付费管理）

**目标**
- 完整的Multi-Agent能力
- 自动化通信助理
- 商业化准备

### 9.4 高阶智能版本（V3.0）- 3个月

**新增功能**
- ✅ Supervisor + Sub Agent协同
- ✅ Multi-Agent会议
- ✅ 企业级权限管理
- ✅ 团队协作功能
- ✅ 私有化部署支持
- ✅ 高级数据分析
- ✅ API开放平台

**目标**
- 满足企业级需求
- 支持私有化部署
- 构建开放生态

### 9.5 未来规划（V4.0+）

**可能的方向**
- 🔮 数字人视频通话
- 🔮 更多AI模型支持
- 🔮 跨应用智能协同
- 🔮 行业解决方案
- 🔮 AI训练和微调平台
- 🔮 更多第三方集成

#### 9.5.1 数字人视频通话技术方案（规划中）

这是AI通话功能的视觉增强版本，在语音对话的基础上增加数字人视频画面，实现更自然的视频通话体验。

**核心技术实现**：

1. **虚拟摄像头驱动安装**：
   - 使用`pyvirtualcam`库提供的安装脚本
   - 为操作系统注册一个虚拟摄像头驱动
   - 需要用户授权安装（类似虚拟音频驱动）
   - 安装后系统摄像头列表中会出现"助手-贾维斯"虚拟摄像头

2. **数字人引擎集成**：
   - **本地方案**：
     - 集成轻量级数字人生成模型（如Wav2Lip、SadTalker）
     - 使用预训练的数字人模型
     - 根据TTS音频实时生成口型同步的视频帧
     - 优点：隐私保护，无需网络
     - 缺点：对硬件要求较高，效果受限
   
   - **云端方案**：
     - 对接专业数字人服务（如腾讯智影、阿里云数字人）
     - 发送TTS音频或文本到云端
     - 接收实时生成的数字人视频流
     - 优点：效果更好，硬件要求低
     - 缺点：需要网络，有延迟

3. **视频帧生成与推流**：
   ```
   AI Agent生成回复文本
          ↓
   阿里云TTS（生成音频）
          ↓
   数字人引擎（音频 + 数字人模型）
          ↓
   生成视频帧（NumPy数组，通常30fps）
          ↓
   Python引擎使用pyvirtualcam推流
          ↓
   虚拟摄像头设备
          ↓
   视频通话应用（微信、Zoom、Teams等）选择"助手-贾维斯"摄像头
          ↓
   对方看到数字人画面
   ```

4. **技术实现细节**：
   ```python
   import pyvirtualcam
   import numpy as np
   
   # 创建虚拟摄像头
   with pyvirtualcam.Camera(width=1280, height=720, fps=30) as cam:
       print(f'虚拟摄像头: {cam.device}')
       
       while True:
           # 从数字人引擎获取视频帧（NumPy数组）
           frame = digital_human_engine.generate_frame(audio_chunk)
           
           # 推流到虚拟摄像头
           cam.send(frame)
           
           # 等待下一帧
           cam.sleep_until_next_frame()
   ```

5. **数字人形象定制**：
   - 用户可上传自己的照片训练个性化数字人
   - 提供多种预设数字人形象（男性、女性、不同年龄段）
   - 支持调整数字人的表情、动作、背景
   - 可配置数字人的服装、发型等外观

6. **性能优化**：
   - **帧缓冲**：预生成若干帧视频，减少实时生成压力
   - **分辨率自适应**：根据网络状况动态调整分辨率（720p/480p/360p）
   - **GPU加速**：使用CUDA/Metal加速视频帧生成
   - **关键帧策略**：静止画面时降低帧率，说话时提高帧率

7. **与视频通话应用集成**：
   - 用户在视频通话软件（微信、Zoom、Teams等）中
   - 打开摄像头设置，选择"助手-贾维斯"虚拟摄像头
   - 开始视频通话，对方看到的是数字人画面
   - 同时配合虚拟音频，实现完整的AI视频通话

8. **应用场景**：
   - **商务会议**：用户不方便露面时，用数字人代替参会
   - **客服视频**：企业客服使用统一的数字人形象
   - **教育培训**：数字人讲师进行在线授课
   - **直播带货**：7×24小时数字人直播

9. **技术挑战与解决方案**：
   - **延迟问题**：
     - 目标：端到端延迟 < 500ms
     - 方案：本地缓存、预生成、模型优化
   - **口型同步**：
     - 目标：音频与口型完全同步
     - 方案：使用Wav2Lip等专业口型同步模型
   - **自然度**：
     - 目标：数字人表情自然，不僵硬
     - 方案：使用高质量预训练模型，增加微表情
   - **资源占用**：
     - 目标：CPU < 50%，GPU < 70%，内存 < 2GB
     - 方案：模型量化、分辨率自适应、帧率动态调整

10. **隐私与安全**：
    - 用户照片仅用于训练个人数字人，不上传云端（本地方案）
    - 云端方案需明确告知用户数据使用方式
    - 提供数字人形象删除功能
    - 视频通话记录可选择是否保存

---

## 10. 成功指标

### 10.1 用户指标

**用户增长**
- **目标**: 
  - MVP版本：1000+注册用户
  - V1.5版本：5000+注册用户
  - V2.0版本：20000+注册用户
  - V3.0版本：50000+注册用户

**用户活跃**
- **DAU/MAU比例**: > 30%
- **7日留存率**: > 40%
- **30日留存率**: > 25%

**用户满意度**
- **NPS（净推荐值）**: > 50
- **应用评分**: > 4.5/5.0
- **用户反馈响应率**: > 90%

### 10.2 业务指标

**功能使用**
- **工作流创建率**: > 80%的用户创建至少1个工作流
- **工作流执行成功率**: > 95%
- **Agent使用率**: > 60%的用户使用Agent功能
- **AI通话使用率**: > 30%的用户使用AI接听功能

**商业化指标**
- **付费转化率**: > 10%
- **ARPU（每用户平均收入）**: > ¥50/月
- **模板市场GMV**: 
  - V2.0版本：¥10万/月
  - V3.0版本：¥50万/月
- **企业客户数**: 
  - V2.0版本：10+
  - V3.0版本：50+

### 10.3 技术指标

**性能指标**
- **API响应时间**: P95 < 200ms
- **工作流执行成功率**: > 95%
- **系统可用性**: > 99.9%
- **错误率**: < 0.1%

**质量指标**
- **Bug修复时间**: 
  - 严重Bug：< 24小时
  - 一般Bug：< 7天
- **用户反馈响应时间**: < 24小时
- **功能发布周期**: 每2周一个迭代

---

## 附录

### 附录A：术语表

| 术语 | 说明 |
|------|------|
| RPA | 机器人流程自动化（Robotic Process Automation） |
| Agent | 智能代理，能够自主决策和执行任务的AI实体 |
| Multi-Agent | 多智能体系统，多个Agent协同工作 |
| ReAct | Reasoning and Acting，推理和行动循环 |
| RAG | 检索增强生成（Retrieval-Augmented Generation） |
| MCP | Model Context Protocol，模型上下文协议 |
| AXUI | Accessibility UI，无障碍用户界面 |
| OCR | 光学字符识别（Optical Character Recognition） |
| ASR | 自动语音识别（Automatic Speech Recognition） |
| TTS | 文本转语音（Text-to-Speech） |
| LLM | 大语言模型（Large Language Model） |
| Token | 模型处理的基本单位 |
| Embedding | 向量嵌入 |
| WebSocket | 全双工通信协议 |
| JWT | JSON Web Token，用于身份认证 |
| RBAC | 基于角色的访问控制 |

### 附录B：参考文档

- **原有功能清单**: `docs/原有功能清单.md`
- **产品需求文档（草稿）**: `desktop/docs/drafts/产品需求文档.md`
- **技术架构文档（草稿）**: `desktop/docs/drafts/技术架构文档.md`

### 附录D：核心设计思想对照表

本表用于验证完整版PRD是否完整体现了原始设计文档中的核心思想和技术架构。

| 核心设计思想 | 原始文档描述 | 完整版PRD体现 | 状态 |
|------------|------------|-------------|------|
| **驾驶舱与引擎分离** | 前端Tauri 2 + React负责UI，后端Python Sidecar负责执行 | ✅ 第1.1节详细说明，第7.1节架构图展示 | ✅ 已完整体现 |
| **AgentScope作为AI核心** | 区别于LangChain，专为Multi-Agent设计 | ✅ 第7.1节明确说明选型理由 | ✅ 已完整体现 |
| **Tauri Sidecar模式** | 使用Tauri管理Python Sidecar生命周期 | ✅ 第7.1节架构图和说明 | ✅ 已完整体现 |
| **智能录制器叠加窗口** | 透明全屏窗口+鼠标穿透+实时高亮 | ✅ 第4.3.2节详细技术实现 | ✅ 已完整体现 |
| **元素稳定定位** | 保存内在属性而非坐标 | ✅ 第4.3.3节和第4.2.4节 | ✅ 已完整体现 |
| **Playwright持久化上下文** | 保持浏览器登录状态 | ✅ 第4.3.4节和第7.1节 | ✅ 已完整体现 |
| **虚拟音频设备** | VB-CABLE/BlackHole实现音频接管 | ✅ 第4.7.1节详细技术实现 | ✅ 已完整体现 |
| **音频重定向闭环** | 扬声器→虚拟输入→AI→虚拟输出→麦克风 | ✅ 第4.7.1节完整流程图和说明 | ✅ 已完整体现 |
| **虚拟摄像头** | pyvirtualcam推流数字人视频 | ✅ 第9.5.1节详细技术方案 | ✅ 已完整体现 |
| **数字人视频通话** | 实时生成视频帧并推流 | ✅ 第9.5.1节完整实现方案 | ✅ 已完整体现 |
| **pywinauto/pyobjc** | 操作系统原生API进行GUI自动化 | ✅ 第7.1节能力层说明 | ✅ 已完整体现 |
| **pynput事件监听** | 全局键鼠事件捕获 | ✅ 第4.3.2节和第7.1节 | ✅ 已完整体现 |
| **OCR降级容错** | Tesseract作为备选方案 | ✅ 第4.2.4节和第7.1节 | ✅ 已完整体现 |
| **通知监听触发** | 监听系统通知自动接听 | ✅ 第4.7.1节和第4.10.5节 | ✅ 已完整体现 |
| **PyInstaller打包** | Python环境打包为独立可执行文件 | ✅ 第7.1节架构说明 | ✅ 已完整体现 |

**验证结论**：

✅ **所有核心设计思想已完整体现在完整版PRD中**

本次更新成功将原始设计文档（产品需求文档草稿和技术架构文档草稿）中的核心理念、技术架构和实现细节完整融入到了产品需求文档完整版中，主要更新包括：

1. **产品愿景**：补充了"驾驶舱与引擎分离"的核心设计哲学
2. **技术架构**：详细展示了PC端核心架构，明确了Sidecar模式和各层职责
3. **智能录制器**：补充了叠加窗口、元素高亮、鼠标穿透的完整技术实现
4. **AI通话**：详细说明了虚拟音频设备、音频重定向闭环的完整流程
5. **数字人视频通话**：补充了虚拟摄像头、视频帧推流的完整技术方案

文档现在完整反映了项目的技术架构设计思想，可以作为开发团队的指导文档。

### 附录C：变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| V1.0 | 2025-11-08 | 初始草稿版本 | - |
| V2.0 | 2025-11-08 | 完整版PRD，整合三端功能 | - |
| V2.1 | 2025-11-08 | 基于原始设计文档的重大更新：<br>1. 补充"驾驶舱与引擎分离"核心设计哲学<br>2. 详细展示PC端核心架构（Tauri + Python Sidecar）<br>3. 补充智能录制器技术实现（叠加窗口、元素高亮）<br>4. 补充AI通话技术实现（虚拟音频、音频重定向）<br>5. 补充数字人视频通话技术方案（虚拟摄像头）<br>6. 明确AgentScope作为Multi-Agent核心框架<br>7. 添加核心设计思想对照表验证完整性 | AI Assistant |
| V2.2 | 2025-11-08 | 更新云端服务技术架构：<br>1. 明确使用Go + Supabase实现云端服务<br>2. 详细说明Supabase核心能力（数据库、认证、存储、实时订阅）<br>3. 说明Go后端服务职责和技术优势<br>4. 强调所有用户数据统一存储在Supabase项目中 | AI Assistant |

---

## 文档结尾

**文档状态**: ✅ 已完成（V2.2）  
**最后更新**: 2025-11-08  
**文档维护**: 产品团队

**说明**: 
本文档（V2.2版本）是基于原始设计文档（产品需求文档草稿和技术架构文档草稿）进行的重大更新，完整整合了核心设计理念和技术架构细节。文档涵盖了PC端、移动端和管理后台三端的详细功能需求，以及完整的技术架构、实现细节、非功能性需求、产品路线图和成功指标。

**核心更新亮点**：
- ✅ 明确"驾驶舱与引擎分离"的核心架构设计
- ✅ 详细的智能录制器技术实现（叠加窗口、元素高亮机制）
- ✅ 完整的AI通话技术方案（虚拟音频、音频重定向闭环）
- ✅ 数字人视频通话技术方案（虚拟摄像头、视频帧推流）
- ✅ AgentScope作为Multi-Agent核心框架的明确定位
- ✅ 云端服务采用Go + Supabase技术栈，统一管理所有用户数据
- ✅ 所有核心设计思想已通过对照表验证完整性

**下一步行动**:
1. 技术团队评审技术架构可行性（重点关注Sidecar模式和虚拟设备集成）
2. UI/UX团队设计交互原型（重点关注叠加窗口和录制体验）
3. 产品团队细化优先级和迭代计划
4. 开发团队制定详细的技术实现方案（参考第7章技术架构）
5. 进行虚拟音频/摄像头驱动的兼容性测试
6. 搭建Supabase项目并设计数据库Schema