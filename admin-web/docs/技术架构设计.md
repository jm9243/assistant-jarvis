# 助手-贾维斯 管理后台前端 - 技术架构设计文档

**版本**: V1.0  
**日期**: 2025-11-08  
**状态**: 规划中（Phase 2+实施）

---

## 说明

> **重要提示**: 管理后台前端属于 Phase 2+ 的迭代内容，Phase 1 阶段暂不开发。
> 
> Phase 1 的重点是为 PC 端提供云端 API 服务，管理后台将在后续迭代中实现。

---

## 目录

1. [架构概述](#1-架构概述)
2. [技术栈选型](#2-技术栈选型)
3. [项目结构](#3-项目结构)
4. [核心模块设计](#4-核心模块设计)
5. [权限控制](#5-权限控制)
6. [性能优化](#6-性能优化)
7. [开发规范](#7-开发规范)

---

## 1. 架构概述

### 1.1 产品定位

管理后台是面向企业管理员、平台运营者的 Web 管理系统，主要功能：
- 用户管理和权限控制
- 数据管理和备份
- 模板市场管理
- 付费和会员管理
- 运营数据分析

### 1.2 设计目标

- **易用性**: 清晰的信息架构，符合管理员使用习惯
- **高性能**: 支持大规模数据查询和统计分析
- **易维护**: 模块化设计，便于功能迭代
- **响应式**: 支持桌面端和平板端访问

---

## 2. 技术栈选型

### 2.1 核心技术

| 技术 | 版本 | 用途 | 选型理由 |
|------|------|------|---------|
| React | 18.x | UI框架 | 生态成熟，性能优秀 |
| Ant Design Pro | 6.x | UI组件库 | 企业级中后台解决方案，开箱即用 |
| Redux Toolkit | 2.x | 状态管理 | 简化Redux使用，官方推荐 |
| React Router | 6.x | 路由管理 | 标准路由库，支持嵌套路由 |
| ECharts | 5.x | 数据可视化 | 功能强大，图表类型丰富 |
| Axios | 1.x | HTTP客户端 | 支持拦截器，易于封装 |
| Vite | 5.x | 构建工具 | 快速的开发体验 |

### 2.2 开发工具

- **TypeScript**: 类型安全
- **ESLint + Prettier**: 代码规范
- **Husky**: Git Hooks
- **Vitest**: 单元测试

---

## 3. 项目结构

```
admin-web/
├── public/                 # 静态资源
├── src/
│   ├── assets/            # 图片、字体等资源
│   ├── components/        # 通用组件
│   │   ├── common/        # 基础组件（表格、表单、图表等）
│   │   ├── layout/        # 布局组件
│   │   └── business/      # 业务组件
│   ├── pages/             # 页面组件
│   │   ├── user/          # 用户管理
│   │   ├── permission/    # 权限管理
│   │   ├── data/          # 数据管理
│   │   ├── template/      # 模板市场
│   │   ├── payment/       # 付费管理
│   │   ├── analytics/     # 运营分析
│   │   ├── content/       # 内容管理
│   │   └── system/        # 系统设置
│   ├── services/          # API服务
│   │   ├── api.ts         # API封装
│   │   ├── user.ts
│   │   ├── template.ts
│   │   └── ...
│   ├── store/             # Redux状态管理
│   │   ├── slices/        # 各模块slice
│   │   └── index.ts
│   ├── utils/             # 工具函数
│   │   ├── request.ts     # HTTP请求封装
│   │   ├── auth.ts        # 认证工具
│   │   └── format.ts      # 格式化工具
│   ├── hooks/             # 自定义Hooks
│   ├── types/             # TypeScript类型定义
│   ├── constants/         # 常量定义
│   ├── routes/            # 路由配置
│   ├── App.tsx
│   └── main.tsx
├── .env.development       # 开发环境配置
├── .env.production        # 生产环境配置
├── package.json
├── tsconfig.json
└── vite.config.ts
```

---

## 4. 核心模块设计

### 4.1 路由设计

```typescript
// routes/index.tsx
import { RouteObject } from 'react-router-dom';

const routes: RouteObject[] = [
  {
    path: '/login',
    element: <LoginPage />,
  },
  {
    path: '/',
    element: <MainLayout />,
    children: [
      {
        path: 'dashboard',
        element: <Dashboard />,
      },
      {
        path: 'users',
        children: [
          { path: 'list', element: <UserList /> },
          { path: 'detail/:id', element: <UserDetail /> },
        ],
      },
      {
        path: 'templates',
        children: [
          { path: 'list', element: <TemplateList /> },
          { path: 'review', element: <TemplateReview /> },
        ],
      },
      // ... 其他路由
    ],
  },
];
```

### 4.2 状态管理

```typescript
// store/slices/userSlice.ts
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

export const fetchUsers = createAsyncThunk(
  'user/fetchUsers',
  async (params: UserQueryParams) => {
    const response = await userApi.getUsers(params);
    return response.data;
  }
);

const userSlice = createSlice({
  name: 'user',
  initialState: {
    list: [],
    total: 0,
    loading: false,
    error: null,
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchUsers.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchUsers.fulfilled, (state, action) => {
        state.list = action.payload.list;
        state.total = action.payload.total;
        state.loading = false;
      })
      .addCase(fetchUsers.rejected, (state, action) => {
        state.error = action.error.message;
        state.loading = false;
      });
  },
});
```

### 4.3 API封装

```typescript
// utils/request.ts
import axios from 'axios';
import { getToken, clearToken } from './auth';

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
});

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const token = getToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// 响应拦截器
request.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      clearToken();
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default request;
```

---

## 5. 权限控制

```typescript
// components/PermissionGuard.tsx
import { Navigate } from 'react-router-dom';
import { usePermission } from '@/hooks/usePermission';

interface Props {
  permission: string;
  children: React.ReactNode;
}

export const PermissionGuard: React.FC<Props> = ({ permission, children }) => {
  const hasPermission = usePermission(permission);
  
  if (!hasPermission) {
    return <Navigate to="/403" />;
  }
  
  return <>{children}</>;
};
```

---

## 6. 性能优化

### 6.1 代码分割

```typescript
// routes/index.tsx
import { lazy } from 'react';

// 路由级别代码分割
const UserList = lazy(() => import('@/pages/user/UserList'));
const TemplateList = lazy(() => import('@/pages/template/TemplateList'));
const Analytics = lazy(() => import('@/pages/analytics/Dashboard'));
```

### 6.2 列表虚拟化

```typescript
// 大列表使用虚拟滚动
import { FixedSizeList } from 'react-window';

const VirtualUserList: React.FC = () => {
  const Row = ({ index, style }) => (
    <div style={style}>
      <UserItem user={users[index]} />
    </div>
  );

  return (
    <FixedSizeList
      height={600}
      itemCount={users.length}
      itemSize={80}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};
```

### 6.3 防抖与节流

```typescript
// utils/debounce.ts
import { useCallback, useRef } from 'react';

export const useDebounce = (fn: Function, delay: number) => {
  const timeoutRef = useRef<NodeJS.Timeout>();
  
  return useCallback((...args: any[]) => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    timeoutRef.current = setTimeout(() => {
      fn(...args);
    }, delay);
  }, [fn, delay]);
};
```

---

## 7. 开发规范

### 7.1 代码规范

```typescript
// 1. 使用ESLint + Prettier
// 2. 遵循Airbnb JavaScript风格指南
// 3. 使用严格的TypeScript类型检查

// 类型定义
interface User {
  id: string;
  email: string;
  username: string;
  createdAt: Date;
}

// 函数注释
/**
 * 获取用户列表
 * @param params 查询参数
 * @returns 用户列表和总数
 */
export const getUserList = async (params: UserQueryParams): Promise<UserListResponse> => {
  const response = await request.get('/api/v1/users', { params });
  return response.data;
};
```

### 7.2 Git提交规范

```bash
# 使用 Conventional Commits 规范

feat: 添加用户管理页面
fix: 修复订单列表分页问题
docs: 更新组件文档
style: 格式化代码
refactor: 重构权限检查逻辑
test: 添加用户列表组件测试
chore: 更新依赖包版本
```

---

## 附录

### 环境变量配置

```bash
# .env.production

# API地址
VITE_API_BASE_URL=https://api.jarvis.com

# Supabase配置
VITE_SUPABASE_URL=https://xxx.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

---

**文档状态**: ⏸️ 规划中（Phase 2+ 实施）  
**最后更新**: 2025-11-08  
**文档维护**: 前端团队

