# åŠ©æ‰‹-è´¾ç»´æ–¯ åç«¯æœåŠ¡ - é¡¹ç›®æ¦‚è§ˆ

## ğŸ“¦ åŸºç¡€æ¡†æ¶æ­å»ºå®Œæˆ

å·²æŒ‰ç…§æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£ï¼Œå®Œæˆåç«¯æœåŠ¡çš„åŸºç¡€æ¡†æ¶æ­å»ºã€‚

## âœ… å·²å®Œæˆå†…å®¹

### 1. é¡¹ç›®ç»“æ„
```
backend/
â”œâ”€â”€ cmd/server/              # ä¸»ç¨‹åºå…¥å£ âœ“
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/                # API å±‚
â”‚   â”‚   â”œâ”€â”€ handler/        # å¤„ç†å™¨ âœ“
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_handler.go
â”‚   â”‚   â”‚   â””â”€â”€ user_handler.go
â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶ âœ“
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”‚   â”œâ”€â”€ cors.go
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.go
â”‚   â”‚   â”‚   â””â”€â”€ rate_limit.go
â”‚   â”‚   â””â”€â”€ websocket/      # WebSocket âœ“
â”‚   â”‚       â”œâ”€â”€ hub.go
â”‚   â”‚       â””â”€â”€ client.go
â”‚   â”œâ”€â”€ service/            # ä¸šåŠ¡é€»è¾‘å±‚ âœ“
â”‚   â”‚   â”œâ”€â”€ auth_service.go
â”‚   â”‚   â””â”€â”€ user_service.go
â”‚   â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚ âœ“
â”‚   â”‚   â””â”€â”€ user_repo.go
â”‚   â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹ âœ“
â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”œâ”€â”€ user.go
â”‚   â”‚   â”œâ”€â”€ workflow.go
â”‚   â”‚   â”œâ”€â”€ task.go
â”‚   â”‚   â””â”€â”€ log.go
â”‚   â”œâ”€â”€ pkg/                # å·¥å…·åŒ… âœ“
â”‚   â”‚   â”œâ”€â”€ supabase/       # Supabase å°è£…
â”‚   â”‚   â”œâ”€â”€ cache/          # Redis ç¼“å­˜å°è£…
â”‚   â”‚   â”œâ”€â”€ logger/         # æ—¥å¿—å°è£…
â”‚   â”‚   â””â”€â”€ utils/          # é€šç”¨å·¥å…·
â”‚   â””â”€â”€ config/             # é…ç½®ç®¡ç† âœ“
â”‚       â””â”€â”€ config.go
â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”œâ”€â”€ Makefile                # æ„å»ºè„šæœ¬ âœ“
â”œâ”€â”€ Dockerfile              # Docker é•œåƒ âœ“
â”œâ”€â”€ docker-compose.yml      # Docker Compose âœ“
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶ âœ“
â”œâ”€â”€ env.example            # ç¯å¢ƒå˜é‡ç¤ºä¾‹ âœ“
â”œâ”€â”€ go.mod                 # Go æ¨¡å— âœ“
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜ âœ“
```

### 2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### âœ… é…ç½®ç®¡ç† (config)
- ç¯å¢ƒå˜é‡åŠ è½½
- é…ç½®éªŒè¯
- å¤šç¯å¢ƒæ”¯æŒ

#### âœ… æ—¥å¿—ç³»ç»Ÿ (logger)
- åŸºäº zap çš„é«˜æ€§èƒ½æ—¥å¿—
- æ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒ
- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º

#### âœ… Supabase å®¢æˆ·ç«¯å°è£…
- æ•°æ®åº“æ“ä½œ
- æ–‡ä»¶å­˜å‚¨
- è®¤è¯æœåŠ¡é›†æˆ

#### âœ… Redis ç¼“å­˜
- åŸºç¡€ç¼“å­˜æ“ä½œ
- æ‰¹é‡åˆ é™¤
- è¿‡æœŸæ—¶é—´ç®¡ç†

#### âœ… æ•°æ®æ¨¡å‹
- User ç”¨æˆ·æ¨¡å‹
- Workflow å·¥ä½œæµæ¨¡å‹
- Task ä»»åŠ¡æ¨¡å‹
- Log æ—¥å¿—æ¨¡å‹
- Device è®¾å¤‡æ¨¡å‹

#### âœ… ä¸­é—´ä»¶
- **è®¤è¯ä¸­é—´ä»¶**: JWT Token éªŒè¯
- **CORS ä¸­é—´ä»¶**: è·¨åŸŸé…ç½®
- **é™æµä¸­é—´ä»¶**: API é¢‘ç‡é™åˆ¶
- **æ—¥å¿—ä¸­é—´ä»¶**: è¯·æ±‚æ—¥å¿—è®°å½•
- **æ¢å¤ä¸­é—´ä»¶**: Panic æ¢å¤

#### âœ… WebSocket å®æ—¶é€šä¿¡
- Hub è¿æ¥ç®¡ç†
- å®¢æˆ·ç«¯è¿æ¥å¤„ç†
- æ¶ˆæ¯å¹¿æ’­
- å¿ƒè·³ä¿æ´»

#### âœ… Repository å±‚
- User Repository (ç¤ºä¾‹)

#### âœ… Service å±‚
- Auth Service (è®¤è¯æœåŠ¡)
- User Service (ç”¨æˆ·æœåŠ¡)

#### âœ… Handler å±‚
- Auth Handler (æ³¨å†Œã€ç™»å½•ã€åˆ·æ–°Token)
- User Handler (è·å–/æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€è®¾å¤‡ç®¡ç†)

### 3. å·²å®ç°çš„ API ç«¯ç‚¹

#### è®¤è¯ç›¸å…³
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ âœ“
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½• âœ“
- `POST /api/v1/auth/refresh` - åˆ·æ–° Token â³

#### ç”¨æˆ·ç®¡ç†
- `GET /api/v1/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯ âœ“
- `PUT /api/v1/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯ âœ“
- `GET /api/v1/users/devices` - è·å–è®¾å¤‡åˆ—è¡¨ â³
- `POST /api/v1/users/devices` - æ³¨å†Œè®¾å¤‡ â³

#### å¾…å®ç°
- å·¥ä½œæµç®¡ç† API
- ä»»åŠ¡ç®¡ç† API
- æ–‡ä»¶ç®¡ç† API
- æ—¥å¿—ç®¡ç† API

### 4. å¼€å‘å·¥å…·

#### âœ… Makefile å‘½ä»¤
- `make help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `make install` - å®‰è£…ä¾èµ–
- `make build` - ç¼–è¯‘é¡¹ç›®
- `make run` - è¿è¡Œé¡¹ç›®
- `make dev` - å¼€å‘æ¨¡å¼è¿è¡Œ
- `make test` - è¿è¡Œæµ‹è¯•
- `make docker-build` - æ„å»º Docker é•œåƒ
- `make docker-up` - å¯åŠ¨ Docker Compose
- `make redis-start` - å¯åŠ¨æœ¬åœ° Redis

#### âœ… Docker æ”¯æŒ
- Dockerfile (å¤šé˜¶æ®µæ„å»º)
- docker-compose.yml (åç«¯ + Redis)

#### âœ… é…ç½®æ–‡ä»¶
- `env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- `.gitignore` - Git å¿½ç•¥è§„åˆ™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒ

```bash
cd backend
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™ Supabase é…ç½®
```

### 2. å®‰è£…ä¾èµ–

```bash
make install
```

### 3. å¯åŠ¨ Redis

```bash
make redis-start
```

### 4. è¿è¡ŒæœåŠ¡

```bash
make run
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨ã€‚

### 5. æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8080/health
```

## ğŸ“‹ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### Phase 1 - æ ¸å¿ƒ API å®ç°

1. **å·¥ä½œæµç®¡ç†**
   - [ ] Workflow Repository
   - [ ] Workflow Service
   - [ ] Workflow Handler
   - [ ] CRUD API å®ç°

2. **ä»»åŠ¡ç®¡ç†**
   - [ ] Task Repository
   - [ ] Task Service  
   - [ ] Task Handler
   - [ ] ä»»åŠ¡çŠ¶æ€åŒæ­¥ API

3. **æ–‡ä»¶ç®¡ç†**
   - [ ] File Service
   - [ ] File Handler
   - [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ API

4. **æ—¥å¿—ç®¡ç†**
   - [ ] Log Repository
   - [ ] Log Service
   - [ ] Log Handler
   - [ ] æ—¥å¿—ä¸ŠæŠ¥/æŸ¥è¯¢ API

5. **è®¾å¤‡ç®¡ç†**
   - [ ] Device Repository
   - [ ] Device Service
   - [ ] è®¾å¤‡æ³¨å†Œ/æ›´æ–° API

6. **WebSocket å®æ—¶é€šä¿¡**
   - [ ] WebSocket Handler
   - [ ] å®æ—¶çŠ¶æ€æ¨é€
   - [ ] ä»»åŠ¡çŠ¶æ€å¹¿æ’­

### Phase 1.5 - å®Œå–„ä¸ä¼˜åŒ–

7. **æ•°æ®åº“è¿ç§»**
   - [ ] åˆ›å»ºè¿ç§»è„šæœ¬
   - [ ] åˆå§‹åŒ–æ•°æ®åº“ Schema

8. **æµ‹è¯•è¦†ç›–**
   - [ ] å•å…ƒæµ‹è¯•
   - [ ] é›†æˆæµ‹è¯•
   - [ ] API æµ‹è¯•

9. **æ–‡æ¡£å®Œå–„**
   - [ ] API æ–‡æ¡£ (Swagger)
   - [ ] éƒ¨ç½²æ–‡æ¡£
   - [ ] å¼€å‘æŒ‡å—

10. **ç›‘æ§å‘Šè­¦**
    - [ ] Sentry é”™è¯¯è¿½è¸ª
    - [ ] æ€§èƒ½ç›‘æ§
    - [ ] å¥åº·æ£€æŸ¥å®Œå–„

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

- **Go 1.21+** - ç¼–ç¨‹è¯­è¨€
- **Gin** - Web æ¡†æ¶
- **Supabase** - BaaS å¹³å°
  - PostgreSQL - æ•°æ®åº“
  - Auth - è®¤è¯æœåŠ¡
  - Storage - æ–‡ä»¶å­˜å‚¨
- **Redis** - ç¼“å­˜
- **WebSocket** - å®æ—¶é€šä¿¡
- **Docker** - å®¹å™¨åŒ–
- **Zap** - æ—¥å¿—åº“

## ğŸ“ å¼€å‘è§„èŒƒ

### Git æäº¤è§„èŒƒ
```
feat: æ·»åŠ å·¥ä½œæµåˆ—è¡¨ API
fix: ä¿®å¤ä»»åŠ¡çŠ¶æ€æ›´æ–°é—®é¢˜
docs: æ›´æ–° API æ–‡æ¡£
refactor: é‡æ„è®¤è¯ä¸­é—´ä»¶
test: æ·»åŠ å·¥ä½œæµæœåŠ¡å•å…ƒæµ‹è¯•
chore: æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬
```

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- éµå¾ª Go å®˜æ–¹å‘½åè§„èŒƒ
- å¯¼å‡ºå‡½æ•°æ·»åŠ æ³¨é‡Š
- é”™è¯¯å¤„ç†è¦å®Œæ•´

## ğŸ¯ é¡¹ç›®çŠ¶æ€

**å½“å‰çŠ¶æ€**: âœ… åŸºç¡€æ¡†æ¶æ­å»ºå®Œæˆ

**å®Œæˆåº¦**: 
- åŸºç¡€æ¶æ„: 100%
- æ ¸å¿ƒ API: 30% (è®¤è¯ã€ç”¨æˆ·ç®¡ç†)
- æµ‹è¯•è¦†ç›–: 0%
- æ–‡æ¡£å®Œå–„: 60%

**ä¸‹ä¸€æ­¥**: å®ç°å·¥ä½œæµç®¡ç† API

---

**æ›´æ–°æ—¶é—´**: 2025-11-08  
**ç»´æŠ¤è€…**: åç«¯å›¢é˜Ÿ

