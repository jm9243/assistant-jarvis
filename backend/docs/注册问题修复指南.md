# 用户注册问题修复指南

## 问题描述

用户注册时出现错误：`failed to get user profile: user not found`

## 根本原因

Supabase 的 Row Level Security (RLS) 策略阻止了使用 anon key 创建 user_profiles 记录。

## 解决方案

### 方案 1：关闭邮箱确认（推荐用于开发环境）

1. 登录 Supabase Dashboard
2. 进入项目设置：Settings → Authentication
3. 找到 "Email Auth" 部分
4. 关闭 "Enable email confirmations"
5. 保存设置

这样注册时会立即返回 access_token，可以用来创建 profile。

### 方案 2：使用 Service Role Key（推荐用于生产环境）

1. 登录 Supabase Dashboard
2. 进入项目设置：Settings → API
3. 复制 "service_role" key（注意：这个 key 有完全权限，不要泄露！）
4. 更新 `.env` 文件：
   ```
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
   ```
5. 修改代码，在创建 profile 时使用 service_role key

### 方案 3：修改 RLS 策略

执行 `migrations/005_fix_user_profiles_rls.sql` 脚本，但这需要配合方案 1 或 2 使用。

## 当前状态

- ✅ Supabase Auth 注册成功
- ✅ 用户 ID 正确返回
- ❌ user_profiles 表插入被 RLS 阻止
- ❌ 查询返回空结果

## 下一步

请选择上述方案之一，然后重新测试注册功能。
